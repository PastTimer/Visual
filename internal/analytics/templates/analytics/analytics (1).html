    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0rem;
            padding: 0rem;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-family: Helvetica, Arial, sans-serif;
            background-color: #f9f9f9;
        }
        main {
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            align-items: stretch;
            margin: 0 5rem 2rem 5rem;
            gap: 0.5rem; 
        }
        footer {
            background-color: #245F3E;
            position: relative;
            bottom: 0;
            width: 100%;
            height: 20rem;
        } 
        .sub {
            font-size: 1.5rem;
            font-weight: 400;  
            margin-top: 0.7rem;
            margin-bottom: 2.5rem;  
            max-width: 90%;
        } 
        * {
            box-sizing: border-box;
        } 
        h2 {
            font-size: 1.75rem;
            font-weight: 500;
            margin: 0 0 1.25rem 0;
        }
        i {
            font-size: 1.75rem;
            color: black; 
            margin-right: 0.75rem;
            font-weight: 400;  
            text-decoration: none;
        }
        a {
            text-decoration: none;   
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
            gap: 2rem;  
            padding: 3rem 0rem 1rem 3rem;
        }  
        header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 1.25rem; 
            margin: 0;
            padding: 0.5rem 1rem;
            border: 1px solid #e0e0e0;
            background-color: #f5f5f5;
            position: relative;
            top: 0;
        } 
        header img {
            border-radius: 50%; 
            border: 4px solid #e4c600;
            margin-right: 0.75rem;
            width: 3.25rem;
            height: 3.25rem;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .dropdown {
            position: relative;
            width: 14.5rem;
        }
        .dropdown-btn { 
            margin: 0;
            width: 100%;
            padding: 0.75rem 1rem;
            border: 0.08rem solid #b6b6b6;
            border-radius: 0.75rem;
            background: #f9f9f9;
            text-align: center;
            cursor: pointer;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 400;
            font-size: 1rem;
        }
        .dropdown-btn:hover{
            background-color: #000000;
            color: white;
        }
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            margin: 0;
            right: 0;
            background: white;
            border: 0.08rem solid #ccc;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 10;
            overflow: hidden;
        }
        .dropdown-item {
            padding: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 400;
            text-align: center;
            border-bottom: 1px solid rgb(196, 196, 196);
        }
        .dropdown-item:hover {
            background-color: #000000;
            color: white;
        }
        .hidden {
            display: none;
        }
        .upper, .time {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }
        .export-btn {
            background-color: #040404;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s;
        }
        .export-btn svg {
            fill: white;
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
        .export-btn:hover {
            background-color: #1d4178;
        }

        .export-btn i {
            color: white;
            font-size: 1.2rem;
            margin: 0;
        }
        .export {
            position: relative;
            display: inline-block;
        }
        .content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .first, .second, .third {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .card {
            flex: 1;
            flex-direction: column;
            min-width: 280px;
            min-height: 180px;
            background: #fff;
            border-radius: 0.75rem;
            border: 0.08rem solid #b6b6b6;
            display: flex;
            justify-content: center;
            align-items: flex-start;  /* Change from center to flex-start */
            padding: 1.5rem;
        }
        .card h4 {
            font-size: 1.25rem;
            font-weight: 400;
            margin: 0 0 1.25rem 0;  /* Remove left margin */
            width: 100%;  /* Add this to ensure full width alignment */
            text-align: left;
        }
        .stat-container {
            flex: 0.33;  /* Change from 1 to 0.33 to take up one-third width */
            min-width: 280px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stat {
            background: #fff;
            border-radius: 0.75rem;
            border: 0.08rem solid #b6b6b6;
            padding: 1.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            height: calc(50% - 0.5rem);
            transition: all 0.2s ease;
        }

        .stat:hover, .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-color: #999;
        }
        .stat-number {
            font-size: 2.25rem;
            font-weight: 600;
            color: #111;
            letter-spacing: -0.5px;
        }
        .stat-label {
            font-size: 0.95rem;
            color: #555;
            font-weight: 500;
        }
        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.15rem;
            color: #16a34a;
            font-weight: 500;
        }
        .stat-change svg {
            color: #16a34a;
        }  
        .stat-change.negative {
            color: #dc2626;
        }

        .stat-change.negative svg {
            fill: #dc2626;
        }

            .popup-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.4);
                z-index: 99;
                justify-content: center;
                align-items: center;
            }
            .date-popup.show {
                transform: scale(1);
                opacity: 1;
            }
            .date-popup {
                background: white;
                border-radius: 1rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                padding: 2rem;
                width: 420px;
                max-width: 95%;
                z-index: 100;
                transform: scale(0.9);
                opacity: 0;
                transition: all 0.25s ease;
            }
            .date-popup h4 {
                font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
                margin-top: 0;
                margin-bottom: 1.5rem;
                font-size: 1.75rem; /* Matches Analytics heading size */
                font-weight: 500;
                color: #000000;
                text-align: center;
                letter-spacing: -0.5px;
            }
            .date-popup label {
                display: block;
                font-size: 0.95rem;
                margin-top: 0.75rem;
                color: #333;
            }
            .date-input {
            width: 100%;
                padding: 1rem; /* Bigger input area */
                border: 1px solid #ccc;
                border-radius: 0.6rem;
                margin-top: 0.5rem;
                font-size: 1.1rem;
            }
            .popup-actions {
                display: flex;
                justify-content: flex-end;
                gap: 0.75rem;
                margin-top: 1.5rem;
            }
            .confirm-btn, .cancel-btn {
                padding: 0.5rem 1rem;
                border: none;
                border-radius: 0.5rem;
                cursor: pointer;
                font-size: 1rem;
                font-weight: 500;
                transition: 0.2s;
            }
            .confirm-btn {
                background-color: black;
                color: white;
            }
            .confirm-btn:hover {
                background-color: #1b4c32;
            }
            .cancel-btn {
                background-color: #ccc;
                color: black;
            }
            .cancel-btn:hover {
                background-color: #aaa;
            }
            #fileType {
                width: 100%;
                padding: 10px;
                border-radius: 10px;
                border: 1px solid #ccc;
                margin-top: 5px;
                font-size: 14px;
                background-color: #f9f9f9;
                cursor: pointer;
            }
            #fileType:hover {
                border-color: #888;
            }
    </style>
</head>
<body> 
    <svg style="display: none;">
        <!-- Export -->
        <symbol id="file-export" viewBox="0 0 640 640" fill="currentColor">
            <path d="M128.5 64C93.2 64 64.5 92.7 64.5 128L64.5 512C64.5 547.3 93.2 576 128.5 576L384.5 576C419.8 576 448.5 547.3 448.5 512L448.5 416L526.6 416L495.6 447C486.2 456.4 486.2 471.6 495.6 480.9C505 490.2 520.2 490.3 529.5 480.9L601.5 408.9C610.9 399.5 610.9 384.3 601.5 375L529.5 303C520.1 293.6 504.9 293.6 495.6 303C486.3 312.4 486.2 327.6 495.6 336.9L526.6 367.9L448.5 367.9L448.5 234.4C448.5 217.4 441.8 201.1 429.8 189.1L323.2 82.7C311.2 70.7 295 64 278 64L128.5 64zM390 240L296.5 240C283.2 240 272.5 229.3 272.5 216L272.5 122.5L390 240zM256.5 392C256.5 378.7 267.2 368 280.5 368L384.5 368L384.5 416L280.5 416C267.2 416 256.5 405.3 256.5 392z"/>
        </symbol> 
        <!-- Stat -->
        <symbol id="upward-trend" viewBox="0 0 640 640" fill="green">
            <path d="M416 224C398.3 224 384 209.7 384 192C384 174.3 398.3 160 416 160L576 160C593.7 160 608 174.3 608 192L608 352C608 369.7 593.7 384 576 384C558.3 384 544 369.7 544 352L544 269.3L374.6 438.7C362.1 451.2 341.8 451.2 329.3 438.7L224 333.3L86.6 470.6C74.1 483.1 53.8 483.1 41.3 470.6C28.8 458.1 28.8 437.8 41.3 425.3L201.3 265.3C213.8 252.8 234.1 252.8 246.6 265.3L352 370.7L498.7 224L416 224z"/>
        </symbol>
        <!-- Downward Trend -->
        <symbol id="downward-trend" viewBox="0 0 640 640" fill="red">
            <path d="M416 416C398.3 416 384 430.3 384 448C384 465.7 398.3 480 416 480L576 480C593.7 480 608 465.7 608 448L608 288C608 270.3 593.7 256 576 256C558.3 256 544 270.3 544 288L544 370.7L374.6 201.3C362.1 188.8 341.8 188.8 329.3 201.3L224 306.7L86.6 169.4C74.1 156.9 53.8 156.9 41.3 169.4C28.8 181.9 28.8 202.2 41.3 214.7L201.3 374.7C213.8 387.2 234.1 387.2 246.6 374.7L352 269.3L498.7 416L416 416z"/>
        </symbol>
    </svg>  
    <header>
        extension
    </header>
    <main> 
       <div class="upper">
            <div class="time">
                <h2 style="margin:0;">Analytics</h2>

                <div class="dropdown" style="margin-left: 1.5rem;">
                    <button class="dropdown-btn">This Quarter ▾</button>

                    <div id="popupOverlay" class="popup-overlay">
                        <div id="datePopup" class="date-popup">
                            <h4>Select Date Range</h4>

                            <label for="startDate">Start Date:</label>
                            <input type="date" id="startDate" class="date-input">

                            <label for="endDate">End Date:</label>
                            <input type="date" id="endDate" class="date-input">

                            <div class="popup-actions">
                                <button id="confirmExport" class="confirm-btn">Confirm</button>
                                <button id="cancelExport" class="cancel-btn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="export">
                <button id="exportBtn" class="export-btn">
                    <svg width="20" height="20" style="fill: currentColor;">
                        <use href="#file-export"/>
                    </svg>
                    Export
                </button>

                <div id="exportDropdown" class="dropdown-menu hidden" style="right: 0; left: auto; text-align:center;">
                        <div class="dropdown-item" data-type="pdf">Export as PDF</div>
                        <div class="dropdown-item" data-type="png">Export as PNG</div>
                        <div class="dropdown-item" data-type="csv">Export as CSV</div>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="first">
                <div class="card">
                    <h4>Active Projects</h4>
                    <canvas id="activeProjectsChart" width="350" height="115"></canvas>
                </div>
                <div class="stat-container">
                    <!-- Stats will be rendered here by JavaScript -->
                </div>
            </div>

            <div class="second">
                <div class="card" style="flex: 3.555;">
                    <h4>Budget Allocation</h4>
                    <canvas id="budgetMultiLineChart" width="600" height="180"></canvas>
                </div>
                <div class="card">
                    <h4>Agenda Distribution</h4>
                    <canvas id="agendaDistributionChart" width="500" height="500"></canvas>
                </div>
            </div>

            <div class="third">
                <div class="card">
                    <h4>Trained Individuals</h4>
                    <canvas id="trainedChart" width="900" height="500"></canvas>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <p>test</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const exportBtn = document.getElementById('exportBtn');
        const popupOverlay = document.getElementById('popupOverlay');
        const datePopup = document.getElementById('datePopup');
        const confirmExport = document.getElementById('confirmExport');
        const cancelExport = document.getElementById('cancelExport');
        const dateRangeBtn = document.querySelector('.dropdown-btn');

        dateRangeBtn.addEventListener('click', e => {
            e.stopPropagation();
            popupOverlay.style.display = 'flex';
            setTimeout(() => datePopup.classList.add('show'), 10);
        });

        popupOverlay.addEventListener('click', (e) => {
            if (e.target === popupOverlay) closePopup();
        });

        cancelExport.addEventListener('click', closePopup);

        function closePopup() {
            datePopup.classList.remove('show');
            setTimeout(() => popupOverlay.style.display = 'none', 200);
        }

        // Declare globally so all functions can access these
        let selectedStartDate = '';
        let selectedEndDate = '';

        confirmExport.addEventListener('click', async () => {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;

            if (!start || !end) {
                alert('Please select both start and end dates.');
                return;
            }
            if (new Date(start) > new Date(end)) {
                alert('Start date cannot be after end date.');
                return;
            }

            // ✅ Update button text
            const startText = new Date(start).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const endText = new Date(end).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            dateRangeBtn.textContent = `${startText} – ${endText} ▾`;

            closePopup();

            // ✅ Save selected dates globally (accessible by export)
            selectedStartDate = start;
            selectedEndDate = end;

            //alert("Date range selected! Now choose a file type to export.");
        });



        // Export as PDF (via html2canvas + jsPDF)
        async function exportAsPDF(startDate, endDate) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    const charts = document.querySelectorAll('canvas');
    
    let pageIndex = 0;

    for (const canvas of charts) {
        const chartTitle = canvas.closest('.card')?.querySelector('h4')?.textContent || 'Chart';
        const imgData = canvas.toDataURL('image/png');

        // Add page for all charts except the first
        if (pageIndex > 0) pdf.addPage();

        // Add chart title
        pdf.setFontSize(16);
        pdf.text(chartTitle, 10, 15);

        // Fit chart nicely within page
        const imgWidth = 180;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        const yOffset = 30; // space below title

        pdf.addImage(imgData, 'PNG', 15, yOffset, imgWidth, imgHeight);
        pageIndex++;
    }

    // Save file
    pdf.save(`Analytics_${startDate}_to_${endDate}.pdf`);
}



        //Export as PNG
        async function exportAsPNG() {
            const content = document.querySelector('main');
            const canvas = await html2canvas(content, { scale: 1.5 });
            const link = document.createElement('a');
            link.download = 'Analytics_Report.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // Export as CSV (simple table structure)
        function exportAsCSV() {
            const rows = [
                ["Category", "Value"],
                ["Active Projects", 10],
                ["Budget Allocated (₱M)", 25],
                ["Trained Individuals", 320]
            ];

            let csvContent = "data:text/csv;charset=utf-8,"
                + rows.map(e => e.join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Analytics_Report.csv");
            document.body.appendChild(link);
            link.click();
        }


        // Main PDF export function (replace with your existing logic)
        async function exportPDF(startDate, endDate) {
            // Example — you can replace this with your real export logic
            alert(`Exporting data from ${startDate} to ${endDate}...`);
        }
        // Select all dropdown buttons
        document.querySelectorAll('.dropdown-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation(); // stop document click
                const menu = btn.nextElementSibling;
                // Close other open menus
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    if (m !== menu) m.classList.add('hidden');
                });
                menu.classList.toggle('hidden');
            });
        });

        // Trigger date popup when clicking "This Quarter"
        document.querySelector('.dropdown-btn').addEventListener('click', e => {
            e.stopPropagation();

            // Hide dropdown menu first
            document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.add('hidden'));

            // Show the date range popup
            popupOverlay.style.display = 'flex';
            setTimeout(() => datePopup.classList.add('show'), 10);
        });

        // Dropdown item click
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', e => {
                e.stopPropagation();
                const menu = item.parentElement;
                const btn = menu.previousElementSibling;
                btn.textContent = e.target.textContent;
                menu.classList.add('hidden');
            });
        });

        const exportDropdown = document.getElementById('exportDropdown');

        exportBtn.addEventListener('click', e => {
            e.stopPropagation();
            exportDropdown.classList.toggle('hidden');
        });

        // Handle export type selection
        exportDropdown.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', async e => {
                const type = e.target.dataset.type;
                exportDropdown.classList.add('hidden');

                if (!selectedStartDate || !selectedEndDate) {
                    alert("Please select a date range first before exporting.");
                    return;
                }

                if (type === 'pdf') {
                    await exportAsPDF(selectedStartDate, selectedEndDate);
                } else if (type === 'png') {
                    await exportAsPNG();
                } else if (type === 'csv') {
                    exportAsCSV();
                }
            });
        });

        // Click outside closes all menus
        document.addEventListener('click', () => {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.add('hidden');
            });
        });
        
        // act project
        const labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"];

        // Update dataset
        const activeProjects = [5, 7, 6, 8, 9, 10];

        const ctx = document.getElementById('activeProjectsChart').getContext('2d');
        const activeProjectsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: "",  
                    data: activeProjects,
                    fill: true,
                    borderColor: "rgba(75, 192, 192, 1)",
                    backgroundColor: "rgba(75, 192, 192, 0.2)",
                    tension: 0.25,
                    pointBackgroundColor: "#fff",
                    pointBorderColor: "rgba(75, 192, 192, 1)",
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { 
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Timeframe',
                            font: {
                                size: 14,
                                family: 'Helvetica'
                            },
                            padding: {
                                top: 10
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#f0f0f0'
                        },
                        title: {
                            display: true,
                            text: 'Projects',
                            font: {
                                size: 14,
                                family: 'Helvetica'
                            }
                        }
                    }
                }
            }
        });
        
        // X-axis: Colleges + Campuses + Additional Categories
        const budgetLabels = [
            "CoE",
            "CTE",
            "CAH",
            "CBA",
            "CCJE",
            "CNHS",
            "CHTM",
            "SOL",
            "SOM",
            "CS", 
            "CAD",
            "Aborlan",
            "Bataraza",
            "Brooke's Point",
            "Cuyo",
            "El Nido",
            "Narra",
            "Quezon",
            "Roxas",
            "San Rafael",
            "Sofronio Española",
            "Taytay",
            "Araceli",
            "Balabac",
            "Curon",
            "Dumaran",
            "Linapacan",
            "Rizal",
            "San Vicente",
            "Graduate School"
        ];

        // Update dummy datasets with new values for added categories
        const dataAllocated = [25,20,18,15,10,8,7,5,6,8,7,12,8,10,6,5,7,9,11,4,3,6,5,4,6,7,5,8,9,10];
        const dataUsed =      [20,15,16,13,8,6,5,4,5,6,5,10,6,8,5,3,6,7,9,3,2,5,4,3,5,6,4,6,7,8];
        const dataRemaining = [5,5,2,2,2,2,2,1,1,2,2,2,2,2,1,2,1,2,2,1,1,1,1,1,1,1,1,2,2,2];

        const ctxBudget = document.getElementById('budgetMultiLineChart').getContext('2d');
        const budgetMultiLineChart = new Chart(ctxBudget, {
            type: 'line',
            data: {
            labels: budgetLabels,
            datasets: [
                {
                label: "Allocated Budget",
                data: dataAllocated,
                borderColor: "rgba(75, 192, 192, 1)",
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                tension: 0.3,
                fill: false,
                pointRadius: 5
                },
                {
                label: "Used Budget",
                data: dataUsed,
                borderColor: "rgba(255, 99, 132, 1)",
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                tension: 0.3,
                fill: false,
                pointRadius: 5
                },
                {
                label: "Remaining Budget",
                data: dataRemaining,
                borderColor: "rgba(255, 206, 86, 1)",
                backgroundColor: "rgba(255, 206, 86, 0.2)",
                tension: 0.3,
                fill: false,
                pointRadius: 5
                }
            ]
            },
            options: {
            responsive: true,
            plugins: {
                legend: {
                position: "top",
                labels: { font: { size: 13 } }
                },
                tooltip: {
                callbacks: {
                    label: function(context) {
                    return `${context.dataset.label}: ₱${context.raw}M`;
                    }
                }
                }
            },
            scales: {
                x: {
                title: { display: true, text: "" },
                ticks: { autoSkip: false, maxRotation: 45, minRotation: 45 } 
                },
                y: {
                beginAtZero: true,
                title: { display: true, text: "Budget" }
                }
            }
            }
        });
        
        // Dummy agenda categories
        const agendaLabels = [
            "Economics, Entrepreneurship, and Livelihood Enhancement",
            "Environmental IEC and Culture Sensitivity",
            "Hospitality and Tourism Industry Enhancement",
            "Agriculture, Environmental Protection, Conservation and Resource Management",
            "Promotive and Preventive Health, Nutrition and Gender Sensitivity",
            "Engineering, Architecture and Appropriate Technology",
            "Public Safety and Security, Disaster Risk Management and Governance",
            "Literacy and Livelihood Learning Systems",
            "Leadership Enhancement and Governance"
        ];

        // Dummy values (distribution counts)
        const agendaData = [15, 20, 10, 12, 8, 5, 6, 4, 7];

        const ctxAgenda = document.getElementById('agendaDistributionChart').getContext('2d');
        const agendaDistributionChart = new Chart(ctxAgenda, {
            type: 'pie',
            data: {
            labels: agendaLabels,
            datasets: [{
                label: "",
                data: agendaData,
                backgroundColor: [
                    "#FF6384", // 1
                    "#36A2EB", // 2
                    "#FFCE56", // 3
                    "#4BC0C0", // 4
                    "#9966FF", // 5
                    "#FF9F40", // 6
                    "#8BC34A", // 7
                    "#E91E63", // 8
                    "#00BCD4"  // 9
                ],
                borderColor: "#fff",
                borderWidth: 1
            }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false,
                        position: "left",
                        labels: {
                            boxWidth: 15,  // Smaller color boxes
                            padding: 15,    // Space between items
                            font: {
                                size: 11,    // Smaller font size
                                family: 'Helvetica'
                            },
                            generateLabels: function(chart) {
                                const data = chart.data;
                                const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                
                                return data.labels.map((label, i) => {
                                    const value = data.datasets[0].data[i];
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return {
                                        text: `${label.substring(0, 30)}... (${percentage}%)`,  // Truncate long text
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        hidden: false,
                                        lineCap: 'butt',
                                        lineDash: [],
                                        lineDashOffset: 0,
                                        lineJoin: 'miter',
                                        lineWidth: 1,
                                        strokeStyle: '#fff',
                                        pointStyle: 'rect',
                                        rotation: 0
                                    };
                                });
                            }
                        }
                    },
                    tooltip: {
                callbacks: {
                    label: function(context) {
                    let total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                    let value = context.raw;
                    let percentage = ((value / total) * 100).toFixed(1);
                    return `${context.label}: ${value} (${percentage}%)`;
                    }
                }
                }
                }
            }
        });
        
        const units = [
        "CoE","CTE","CAH","CBA","CCJE","CNHS","CHTM","SOL","SOM","CS","CAD",
        "Aborlan","Bataraza","Brooke's Point","Cuyo","El Nido","Narra","Quezon",
        "Roxas","San Rafael","Sofronio Española","Taytay","Araceli","Balabac",
        "Curon","Dumaran","Linapacan","Rizal","San Vicente","Graduate School"
        ];

        // Dummy data
        const dummyCounts = {
        "CoE": 320,"CTE": 290,"CAH": 210,"CBA": 180,"CCJE": 95,"CNHS": 230,"CHTM": 160,"SOL": 75,"SOM": 200,"CS": 140,"CAD": 85,
        "Aborlan": 60,"Bataraza": 55,"Brooke's Point": 70,"Cuyo": 30,"El Nido": 45,"Narra": 50,"Quezon": 40,"Roxas": 35,"San Rafael": 20,
        "Sofronio Española": 18,"Taytay": 25,"Araceli": 12,"Balabac": 8,"Curon": 10,"Dumaran": 14,"Linapacan": 6,"Rizal": 22,"San Vicente": 9,"Graduate School": 27
        };

        // Sort data by count descending
        const sorted = Object.entries(dummyCounts).sort((a, b) => b[1] - a[1]);
        const trainedLabels = sorted.map(([u]) => u);  
        const trainedData = sorted.map(([_, v]) => v);  

        const ctxTrained = document.getElementById('trainedChart').getContext('2d');  
        const trainedChart = new Chart(ctxTrained, {
            type: 'bar',
            data: {
                labels: trainedLabels,  // Updated to use trainedLabels
                datasets: [{
                    label: 'Trained Individuals',
                    data: trainedData,  // Updated to use trainedData
                    backgroundColor: trainedLabels.map((_, i) => {  // Updated to use trainedLabels
                        const hue = Math.floor((i / trainedLabels.length) * 270);
                        return `hsl(${hue} 70% 55%)`;
                    }),
                    borderColor: '#ffffff',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y', 
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                    label: function(context) {
                        const value = context.raw;
                        const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                        const pct = ((value / total) * 100).toFixed(1);
                        return `${context.label}: ${value} (${pct}%)`;
                    }
                    }
                },
                datalabels: {
                    anchor: 'end',
                    align: 'right',
                    formatter: (val) => val,
                    color: '#111',
                    font: { weight: 'bold' }
                }
            }
            }
        });
        
        // Update the stats data to include trend direction
const statsData = [
    {
        label: "Active Users",
        number: "247",
        change: +12,
        trend: "up"
    },
    {
        label: "Total Visits",
        number: "1,429",
        change: -8,
        trend: "down"
    }
];

// Function to render stats
function renderStats() {
    const statContainer = document.querySelector('.stat-container');
    statContainer.innerHTML = statsData.map(stat => `
        <div class="stat">
            <div class="stat-label">${stat.label}</div>
            <div class="stat-number">${stat.number}</div>
            <div class="stat-change ${stat.trend === 'down' ? 'negative' : ''}">
                <svg width="50" height="50" style="fill: currentColor;">
                    <use href="#${stat.trend === 'down' ? 'downward-trend' : 'upward-trend'}"/>
                </svg>
                ${Math.abs(stat.change)}% from last month
            </div>
        </div>
    `).join('');
}

// Call render function when page loads
document.addEventListener('DOMContentLoaded', renderStats);
        
        document.getElementById('exportBtn').addEventListener('click', async function () {
            try {
                // Show agenda legend for PDF
                agendaDistributionChart.options.plugins.legend.display = true;
                agendaDistributionChart.update();
                await new Promise(r => setTimeout(r, 500)); // small delay to render

                const charts = [
                    { title: 'Active Projects', chart: activeProjectsChart },
                    { title: 'Budget Allocation', chart: budgetMultiLineChart },
                    { title: 'Agenda Distribution', chart: agendaDistributionChart },
                    { title: 'Trained Individuals', chart: trainedChart }
                ];

                const pdfContainer = document.createElement('div');
                pdfContainer.style.background = 'white';

                charts.forEach((c, index) => {
                    // ✅ FIX: declare pageDiv
                    const pageDiv = document.createElement('div');
                    pageDiv.className = 'pdf-page';
                    pageDiv.style.margin = '0';
                    pageDiv.style.padding = '0';
                    pageDiv.style.textAlign = 'center';

                    // Title
                    const title = document.createElement('h2');
                    title.textContent = c.title;
                    title.style.margin = '0 0 10px 0';
                    pageDiv.appendChild(title);

                    // Render chart fully before capture
                    c.chart.update('none');

                    // Chart image
                    const img = new Image();
                    img.src = c.chart.toBase64Image();
                    img.style.display = "block";
                    img.style.margin = "0 auto";
                    img.style.maxWidth = "95%";
                    img.style.height = "auto";

                    pageDiv.appendChild(img);

                    if (index < charts.length - 1) {
                        pageDiv.style.pageBreakAfter = 'always';
                    }
                    pdfContainer.appendChild(pageDiv);
                });

                const options = {
                    margin: 10,
                    filename: 'analytics-charts.pdf',
                    image: { type: 'jpeg', quality: 1 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
                };

                await html2pdf().from(pdfContainer).set(options).save();

                // Hide agenda legend again
                agendaDistributionChart.options.plugins.legend.display = false;
                agendaDistributionChart.update();

            } catch (error) {
                console.error('PDF export failed:', error);
                alert('PDF export failed.');
            }
        });
    </script>
    {% comment %} ashdk {% endcomment %}
</body>
</html>