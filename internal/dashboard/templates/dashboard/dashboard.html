{% extends "base_internal.html" %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link href="https://fonts.googleapis.com/css?family=Inter:400,700,800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'templates/dashboard.css' %}" rel="stylesheet">
</head>

<body>
    <div class="main-container">
        <div class="container-1">
            <div class="container-1A">
                <div class="container-1A-row">
                    <div class="welcome-text">Welcome</div>
                    <div class="ueso-text">to UESO MIS</div>
                </div>
                {% if user.role == "COORDINATOR" %}
                    <div class="viewing-text">You are currently viewing as a coordinator.</div>
                {% elif user.role == "PROGRAM_HEAD" %}
                    <div class="viewing-text">You are currently viewing as a program head.</div>
                {% elif user.role == "DEAN" %}
                    <div class="viewing-text">You are currently viewing as a dean.</div>
                {% elif user.role == "UESO" %}
                    <div class="viewing-text">You are currently viewing as a UESO member.</div>
                {% elif user.role == "VP" %}
                    <div class="viewing-text">You are currently viewing as a vice president.</div>
                {% elif user.role == "DIRECTOR" %}
                    <div class="viewing-text">You are currently viewing as a director.</div>
                {% endif %}
            </div>
            <div class="container-1B">
                <div class="quarter-text">This Quarter</div>
                <div class="dropdown-arrow">
                    <!-- Simple dropdown arrow SVG -->
                    <svg width="16" height="16" viewBox="0 0 16 16">
                        <polyline points="4,6 8,10 12,6" fill="none" stroke="#000" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Overview Section -->
        <div class="overview-section">
            <div class="overview-text">Overview</div>
            <div class="container-2">
                <a class="container-2A" href="{% url 'request_dispatcher' %}?status=PENDING">
                    <div class="container-2A-number">{{ pending_requests.count }}</div>
                    <div class="container-2A-name">Request Pending</div>
                </a>
                <a class="container-2A" href="{% url 'project_dispatcher' %}?status=IN_PROGRESS">
                    <div class="container-2A-number">{{ inprogress_projects.count }}</div>
                    <div class="container-2A-name">Ongoing Projects</div>
                </a>
                <a class="container-2A" href="{% url 'experts' %}">
                    <div class="container-2A-number">{{ expert_users.count }}</div>
                    <div class="container-2A-name">Experts Active</div>
                </a>

                {% if request.user.role == "UESO" or request.user.role == "VP" or request.user.role == "DIRECTOR" %}
                <a class="container-2A" href="{% url 'calendar' %}">
                    <div class="container-2A-number">{{ events_in_calendar }}</div>
                    <div class="container-2A-name">Events in Calendar</div>
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Summary Section -->
        <div class="summary-section">
            <div class="summary-text">Summary</div>
            <div class="container-3">
                <!-- Charts Container: two charts inside one bordered box with expand icon -->
                <div class="charts-container-outer">
                    <div class="expand-icon-container">
                        <svg class="expand-icon" width="16" height="16">
                          <use href="#icon-expand"></use>
                        </svg>
                    </div>
                    <div class="charts-inner">
                        <!-- Agenda Distribution Here (Distribution of Project Depending on their Agenda) -->
                    </div>
                </div>

                <!-- Calendar Container (blank, with expand icon) -->
                <div class="calendar-container">
                    <canvas id="agendaPieChart" width="340" height="340"></canvas>
                    <div class="expand-icon-container">
                        <svg class="expand-icon" width="16" height="16">
                          <use href="#icon-expand"></use>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

            <!-- Project Summary Table now below charts and calendar -->
            <table class="user-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Leader</th>
                    <th>College/Unit</th>
                    <th>Last Updated</th>
                    <th>Start Date</th>
                    <th>Progress</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects %}
                <tr>
                    <td>
                        <a href="{% url 'project_profile' project.id %}" class="name-link" title="{{ project.title }}">
                            {{ project.title|truncatechars:20 }}
                        </a>
                    </td>
                    <td><a href="{% url 'user_profile' project.project_leader.id %}" class="name-link">{{ project.project_leader.get_full_name }}</a></td>
                    <td>{% if project.project_leader.college %}{{ project.project_leader.college.name }}{% else %}<em>-</em>{% endif %}</td>
                    <td>{{ project.updated_at|date:"Y-m-d" }}</td>
                    <td>{{ project.start_date|date:"Y-m-d" }}</td>
                    <td>{{ project.progress_display }}</td>
                    <td>{{ project.get_status_display }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="7" style="text-align:center;">No projects found.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Goal Section (keep existing goals for VP/Director) -->
        {% if vpde_content %}
        <div class="goal-section">
            <div class="goal-text">Goals <span style="color:gray; font-size:medium;">(Not yet implemented)</span></div>
            <div class="goal-card-container">
            <div class="goal-card">
                <div class="goal-card-kebab"> <svg class="kebab-svg"><use href="#kebab-icon"/></svg> </div>
                <div class="goal-card-percent">75%</div>
                <div class="goal-card-title">100 Extension Projects for 2025</div>
            </div>
            <div class="goal-card">
                <div class="goal-card-kebab"> <svg class="kebab-svg"><use href="#kebab-icon"/></svg> </div>
                <div class="goal-card-percent">30%</div>
                <div class="goal-card-title">10 SDG Extension Projects for 2025</div>
            </div>
            <div class="goal-card">
                <div class="goal-card-kebab"> <svg class="kebab-svg"><use href="#kebab-icon"/></svg> </div>
                <div class="goal-card-percent">90%</div>
                <div class="goal-card-title">5 Student Involved Extension Projects for 2025</div>
            </div>
            <div class="goal-card">
                <div class="goal-card-kebab"> <svg class="kebab-svg"><use href="#kebab-icon"/></svg> </div>
                <div class="goal-card-percent">50%</div>
                <div class="goal-card-title">10 Eco-Tourism Projects for 2025</div>
            </div>
            </div>
        </div>
        {% endif %}
</body>

</div>
<!-- SVG Sprite Section -->
<svg style="display:none;">

    <!-- Expand -->
    <symbol id="icon-expand" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15.35 5.43923V1M15.35 1H10.8656M15.35 1L9.96875 6.26404M5.48438 15.2055L1 15.226V10.7663M6.38125 9.87846L1 15.2055" stroke="black" stroke-width="0.9" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- Dropdown -->
    <symbol id="icon-dropdown" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polyline points="4,6 8,10 12,6" fill="none" stroke="#000" stroke-width="2"/>
    </symbol>

    <!-- Kebab -->
    <symbol id="kebab-icon" viewBox="0 0 4 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 16C1.45 16 0.979167 15.8042 0.5875 15.4125C0.195833 15.0208 0 14.55 0 14C0 13.45 0.195833 12.9792 0.5875 12.5875C0.979167 12.1958 1.45 12 2 12C2.55 12 3.02083 12.1958 3.4125 12.5875C3.80417 12.9792 4 13.45 4 14C4 14.55 3.80417 15.0208 3.4125 15.4125C3.02083 15.8042 2.55 16 2 16ZM2 10C1.45 10 0.979167 9.80417 0.5875 9.4125C0.195833 9.02083 0 8.55 0 8C0 7.45 0.195833 6.97917 0.5875 6.5875C0.979167 6.19583 1.45 6 2 6C2.55 6 3.02083 6.19583 3.4125 6.5875C3.80417 6.97917 4 7.45 4 8C4 8.55 3.80417 9.02083 3.4125 9.4125C3.02083 9.80417 2.55 10 2 10ZM2 4C1.45 4 0.979167 3.80417 0.5875 3.4125C0.195833 3.02083 0 2.55 0 2C0 1.45 0.195833 0.979167 0.5875 0.5875C0.979167 0.195833 1.45 0 2 0C2.55 0 3.02083 0.195833 3.4125 0.5875C3.80417 0.979167 4 1.45 4 2C4 2.55 3.80417 3.02083 3.4125 3.4125C3.02083 3.80417 2.55 4 2 4Z" fill="#1D1B20"/>
    </symbol>
</svg>

</body>
</html>

{% endblock %}