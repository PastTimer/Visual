{% extends base_template %}
{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ expert.get_full_name }} Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <style>
        body {
            font-family: Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #e9e9e9;
        }
        /* ... (all other user-provided styles remain here) ... */

        main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: stretch;
            gap: 3rem;
        }

        header {
            background-color: #245F3E;
            position: relative;
            top: 0;
            width: 100%;
            padding: 0;
            height: 4rem;
        }

        footer {
            background-color: #245F3E;
            position: relative;
            bottom: 0;
            width: 100%;
            height: 20rem;
        }

        main > section {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            flex-wrap: wrap;
            background-color: #fbfbfb;
            box-shadow: 0 6px 0.5rem rgba(0, 0, 0, 0.2);
        }

        section > div {
            margin: 3rem;
            height: 100%;
            display: block;
            max-width: none;
        }

        .propic img {
            width: 15rem;
            height: 15rem;
            object-fit: cover;
            border-radius: 50%;
            box-shadow: 0 2px 1rem rgba(0, 0, 0, 0.2);
            /* Added Border for contrast */
            border: 5px solid #245F3E; 
        }

        section > div > h1 {
            font-size: 4rem;
            font-weight: 400;
            margin-bottom: 1rem;
        }

        section > div > h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.35rem;
        }

        section > div > p {
            font-size: 1rem;
            font-weight: 400;
            margin: 0 0 1rem 0;
            line-height: 1.25;
        }

        .personal-info {
            display: block;
            flex-basis: 20rem;
            flex-grow: 1;
            margin: 3rem 1rem;
        }

        .personal-info h2 {
            font-size: 2rem;
            font-weight: 300;
        }

        .personal-info h4 {
            font-size: 1rem;
            font-weight: 400;
            margin-top: -1rem;
            margin-bottom: 1rem;
        }

        .personal-info img {
            border-radius: 50%;
            max-height: 5rem;
            object-fit: contain;
        }

        .expertise {
            margin: 3rem 1rem;
            flex-basis: 17rem;
            flex-grow: 1;
        }

        .contact {
            margin: 3rem 1rem;
            flex-basis: 17rem;
            flex-grow: 1;
        }

        .bio {
            background-color: whitesmoke;
            flex-basis: 20rem;
            flex-grow: 1;
            padding: 0.5rem 2.5rem;
            margin: 1rem 0.75rem;
        }

        .lower {
            background-color: #e9e9e9;
        }

        .lower-header {
            border-bottom: 1px solid #ccc;
            margin: 0 -2.5rem 0 -2.5rem;
            padding: 0 2.5rem;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .lower-header h1 {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .project {
            background-color: whitesmoke;
            flex-basis: 35rem;
            flex-grow: 2;
            padding: 0.5rem 2.5rem;
            margin: 1rem 0.75rem;
        }
        
        .sort-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #333;
            margin-left: 0.5rem;
        }
        
        .project-card {
            display: grid;
            grid-template-rows: 1fr 1fr;
            gap: 0;
            margin: -0.5rem -2.5rem;
        }

        .project-card > div {
            border-bottom: 1px rgb(122, 122, 122) solid;
            padding: 1rem 3rem;
            margin-bottom: 0;
        }

        .project-card h5 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0.25rem 0 1rem 0;
            color: #222;
            text-decoration: none;
        }

        .title:hover {
            color: #007bff;
            text-decoration: none;
        }

        .project-authors {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .project-authors content {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 0.75rem;
        }

        .project-authors img {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            object-fit: cover;
            border: 0.08rem solid #ccc;
        }

        .project-authors a {
            font-size: 0.9rem;
            color: #000000;
            text-decoration: none;
        }

        .project-authors a:hover {
            color: #007bff;
        }

        .view {
            display: inline-block;
            margin-top: 0.75rem;
            font-size: 0.9rem;
            color: #007bff;
            text-decoration: none;
        }

        .view:hover {
            text-decoration: underline;
        }

        .project-tags {
            margin: 1rem 0;
        }

        .campus {
            background-color: #ff9f10;
            color: rgb(55, 39, 0);
            border: 0.08rem solid #ff9f10;
            font-weight: 600;
            padding: 0.35rem 0.6rem;
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .agenda {
            background: linear-gradient(90deg, white, #00ff6e3d);
            color: #313131;
            border: 0.08rem solid #313131;
            font-weight: 500;
            padding: 0.35rem 0.6rem;
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .status {
            background-color: whitesmoke;
            color: #1CB889;
            border: 0.08rem solid #1CB889;
            font-weight: 500;
            padding: 0.35rem 0.6rem;
            margin-right: 0.5rem;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            .personal-info, .expertise, .contact, .bio, .project {
                flex-basis: 100%;
                margin-left: 0.5rem;
                margin-right: 0.5rem;
            }
            section:first-child {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        </header>
    <main> 
        <section>
            <div class="propic">
                <img src="{% if expert.profile_picture %}{{ expert.profile_picture.url }}{% else %}{{ expert.profile_picture_or_initial }}{% endif %}"
                    class="propic"
                    alt="{{ expert.get_full_name }} profile picture"
                    onerror='this.onerror=null; this.src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTO3YkerCVdYtyi2McC6l-feLDSDl2KDOzFig&s";'>
            </div>

            <div class="personal-info">
                <h2>{{ expert.get_full_name }}</h2>
                <h4>
                    <i class="fas fa-map-marker-alt" style="color:red; margin-right:0.5rem;"></i> 
                    PSU - {{ expert.get_campus_display|default:"N/A" }}
                </h4>
                <img src="{% if expert.college %}{% static 'media/colleges/logos' %}/{{ expert.college.name }}.png{% else %}{% static 'media/colleges/logos/Default.png' %}{% endif %}"
                    alt="{{ expert.college.name|default:'College Logo' }}"
                    onerror='this.onerror=null; this.src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTO3YkerCVdYtyi2McC6l-feLDSDl2KDOzFig&s";'>
            </div>
            
            <div class="expertise">
                <h5>Field of Expertise:</h5>
                <p>{{ expert.expertise|default:"None Defined" }}</p>
                <h5>Degree:</h5>
                <p>{{ expert.degree|default:"N/A" }}</p>
            </div>
            
            <div class="contact">
                <h5>Email:</h5>
                <p>{{ expert.email }}</p>
                <h5>Contact No:</h5>
                <p>{{ expert.contact_no }}</p>
            </div>
        </section>
        
        <section class="lower">
            <div class="bio">
                <div class="lower-header">
                    <h1>Status & Role</h1>
                </div>
                <p style="margin-top: 1rem;">
                    <strong>Role:</strong> {{ expert.get_role_display }}
                    <br>
                    <strong>Expert Status:</strong> 
                    {% if expert.is_expert %}
                        <span style="color: #1CB889;">Designated Expert (Verified)</span>
                    {% else %}
                        <span style="color: #ff9f10;">Not Designated Expert</span>
                    {% endif %}
                </p>
            </div>
            
            <div class="project">
                <div class="lower-header"> 
                    <div>
                        <h1>Projects Led ({{ expert.led_projects.count }})</h1>   
                    </div>
                    <div style="display: flex; flex-shrink: 3;">
                         <div class="dropdown">
                            <button class="dropdown-btn">Sort by Name</button>
                        </div> 
                    </div>
                </div>
                <div class="project-card"> 
                    {% for project in expert.led_projects.all %}
                    <div>
                        <h5>{{ project.start_date|date:"F Y" }} - {{ project.estimated_end_date|date:"F Y" }}</h5>
                        
                        <a href="{% url 'project_profile_view' project.pk %}" class="title">{{ project.title }}</a>
                        
                        <section class="project-tags">
                            <button class="campus">PSU - {{ project.project_leader.get_campus_display|default:'N/A' }}</button>
                            <button class="agenda">{{ project.agenda.name|default:"No Agenda" }}</button>
                            <button class="status">{{ project.get_status_display }}</button>
                        </section>
                        
                        <section class="project-authors"> 
                            <content>
                                {% with leader=project.project_leader %}
                                    <img src="{% if leader.profile_picture %}{{ leader.profile_picture.url }}{% else %}{{ leader.profile_picture_or_initial }}{% endif %}" alt="Project Leader"
                                        onerror="this.onerror=null; this.src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTO3YkerCVdYtyi2McC6l-feLDSDl2KDOzFig&s';">
                                    <a href="{% url 'expert_profile' leader.pk %}">{{ leader.get_full_name }}</a> 
                                {% endwith %}
                            </content>
                        </section>

                        <a href="{% url 'project_profile_view' project.pk %}" class="view">View Details</a> 
                    </div> 
                    {% empty %}
                        <div style="padding: 1rem 3rem;">
                            <p style="color: #666;">This expert has not led any projects yet.</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </section>
    </main>
    <footer>
        </footer> 
    <script> 
        // JavaScript from user's provided template is kept for basic dropdown functionality
        document.querySelectorAll('.dropdown-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation(); 
                const menu = btn.nextElementSibling;
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    if (m !== menu) m.classList.add('hidden');
                });
                menu.classList.toggle('hidden');
            });
        });
        document.addEventListener('click', () => {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.add('hidden');
            });
        });     
    </script>
</body>
</html>
{% endblock %}