{% extends "base_internal.html" %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pool of Experts</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/archive/styles.css' %}" rel="stylesheet"> 
</head>
<body>
	<div class="main-container">
		<div class="search-and-controls">
			<div class="search-container" style="box-shadow: none;">
                
				<div class="search-container">
                    <form class="search-bar" id="searchForm" method="get" action="#">
                        <svg width="16" height="16" style="margin-right:10px;"> <use href="#icon-search"></use> </svg>
                        <input type="text" name="search" placeholder="Search project title or leader name" />
                        <button type="button" id="filterBtn" style="background:none;border:none;padding:0;margin-right:5px;cursor:pointer; display: none;"> 
                            <svg width="16" height="16"> <use href="#icon-filter"></use> </svg>
                        </button>
                        <div id="filterDropdown" class="filter-dropdown" style="display: none;">
                            <div class="filter-grid" style="grid-template-columns: repeat(2, 1fr); grid-template-rows: 1fr;">
                                <label>Sort By
                                    <select name="sort_by">
                                        <option value="title">Title</option>
                                        <option value="start_date">Date Started</option>
                                        <option value="project_leader__last_name">Project Leader</option>
                                        <option value="status">Status</option>
                                    </select>
                                </label>
                                <label>Order
                                    <select name="order">
                                        <option value="asc">Ascending</option>
                                        <option value="desc">Descending</option>
                                    </select>
                                </label>
                                <label>Status
                                    <select name="status">
                                        <option value="">All Statuses</option>
                                        <option value="NOT_STARTED">Not Started</option>
                                        <option value="IN_PROGRESS">In Progress</option>
                                        <option value="COMPLETED">Completed</option>
                                        <option value="ON_HOLD">On Hold</option>
                                        <option value="CANCELLED">Cancelled</option>
                                    </select>
                                </label>
                                <label>Date
                                    <input type="date" name="date" style="width: 87%"/>
                                </label>
                            </div>
                            <div class="filter-actions">
                                <button type="submit" class="filter-apply">Apply</button>
                                <button type="button" id="closeFilter" class="filter-close">Close</button>
                            </div>
                        </div>
                    </form>
                </div>

				<div class="view-buttons">
                    <button class="view-btn active" id="gridViewBtn" title="Grid View">
                        <svg width="28" height="28"><use id="gridIconUse" href="#card"></use></svg>
                    </button>
                    <button class="view-btn" id="listViewBtn" title="List View">
                        <svg width="28" height="28"><use id="listIconUse" href="#list"></use></svg>
                    </button>
				</div>
			</div>
            
            <form id="expertFilterForm" class="hidden">
                 <input type="hidden" name="search" id="hiddenSearchInput" value="">
                 <select name="sort_by">
                    <option value="last_name">Last Name</option>
                    <option value="expertise">Expertise</option>
                    <option value="college__name">College</option>
                    <option value="campus">Campus</option>
                 </select>
                 <select name="order">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                 </select>
            </form>
		</div>
          
        <div class="container-a"> 
            <div class="container-a">
                <div class="project-text" style="margin-right: 1rem;">Pool of Experts</div> 
                <div class="dropdown">
                    <button class="dropdown-button" id="collegeDropdownBtn">
                        <span id="currentFilterDisplay">All Experts</span> 
                        <svg width="15" height="10" style="margin-left: 10px;"> <use href="#dropdown-icon"></use> </svg>
                    </button>
                    <div class="dropdown-content hidden" id="collegeDropdownMenu">
                        {% for option in dropdown_options %}
                            <div class="dropdown-item" data-filter-key="{{ option.filter_key }}" data-name="{{ option.name }}">
                                {{ option.name }} 
                                {% if not option.is_default %}({{ option.count|default:0 }}){% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% if can_generate_teams %}
			    <button id="generateTeamBtn" class="generate-btn">
                    <i class="fas fa-robot"></i> Generate Team
                </button>
            {% endif %}
		</div>
        
		<div id="contentArea">
            
            <div class="expert-container" id="expertGrid">
                <p id="loadingIndicator" style="width: 100%; text-align: center;">Loading experts...</p>
            </div>

            <table class="user-table hidden" id="expertList">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>College</th>
                    <th>Expertise</th>
                    <th>Campus</th>
                    <th>Contact/Email</th>
                </tr>
            </thead>
            <tbody id="expertListBody">
            </tbody>
            </table>
            
            <div class="pagination hidden" id="expertPagination">
            </div>
            
		</div>

	</div>

    <div id="aiInputModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" id="closeInputModal">&times;</span>
            <h2 style="color: #00681a;"><i class="fas fa-search"></i> AI Team Requirements</h2>
            <form id="aiPromptForm">
                <label for="aiTopic">Expertise/Topic Required:</label>
                <input type="text" id="aiTopic" name="topic" placeholder="e.g., Beekeeping, Data Analysis" required>
                
                <label for="aiMembers">Number of Team Members:</label>
                <input type="number" id="aiMembers" name="num_members" value="4" min="1" required>
                
                <div style="text-align: right; margin-top: 20px;">
                    <button type="submit" class="generate-btn" style="width: auto; padding: 10px 20px;">
                        Analyze & Generate Team
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="teamResultsModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" id="closeResultsModal">&times;</span>
            <h2 style="color: #00681a;"><i class="fas fa-robot"></i> AI Team Generation Results</h2>
            <div id="modalBodyContent">
                <p id="loadingMessage">Generating teams, please wait...</p>
            </div>
            <div id="modalFooter" style="text-align: right; margin-top: 20px;">
                 <button id="confirmTeamsBtn" class="filter-apply hidden" style="background-color: #00681a;">
                    Confirm & Save Teams
                </button>
            </div>
        </div>
    </div> 
    
<!-- SVG Sprite Section -->
<svg style="display:none;">
    <symbol id="dropdown-icon" viewBox="0 0 15 10" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.11427 6.46831L12.3293 1.25327C12.4265 1.15265 12.5427 1.07239 12.6713 1.01717C12.7998 0.961959 12.9381 0.932896 13.0779 0.93168C13.2178 0.930465 13.3566 0.957121 13.486 1.01009C13.6155 1.06307 13.7331 1.1413 13.8321 1.24022C13.931 1.33914 14.0092 1.45677 14.0622 1.58624C14.1152 1.71572 14.1418 1.85445 14.1406 1.99434C14.1394 2.13423 14.1103 2.27247 14.0551 2.40101C13.9999 2.52954 13.9196 2.6458 13.819 2.74298L7.85912 8.70287C7.66155 8.90038 7.39363 9.01133 7.11427 9.01133C6.83490 9.01133 6.56698 8.90038 6.36941 8.70287L0.409525 2.74298C0.308901 2.6458 0.228639 2.52954 0.173424 2.40101C0.118209 2.27247 0.089146 2.13423 0.0879304 1.99434C0.0867148 1.85445 0.113371 1.71572 0.166344 1.58624C0.219317 1.45677 0.297546 1.33914 0.396466 1.24022C0.495386 1.1413 0.613016 1.06307 0.742492 1.01009C0.871969 0.957121 1.0107 0.930465 1.15059 0.93168C1.29048 0.932896 1.42872 0.961959 1.55726 1.01717C1.68579 1.07239 1.80205 1.15265 1.89923 1.25327L7.11427 6.46831Z" fill="black"/>
    </symbol>

    <symbol id="icon-search" viewBox="0 0 21 21" fill="none">
        <path d="M8.89152 15.9057C9.75056 15.9057 10.6012 15.7365 11.3948 15.4077C12.1885 15.079 12.9096 14.5972 13.5171 13.9897C14.1245 13.3823 14.6064 12.6612 14.9351 11.8675C15.2638 11.0739 15.4330 10.2232 15.4330 9.36417C15.4330 8.50513 15.2638 7.65450 14.9351 6.86084C14.6064 6.06719 14.1245 5.34606 13.5171 4.73862C12.9096 4.13119 12.1885 3.64934 11.3948 3.32060C10.6012 2.99186 9.75056 2.82266 8.89152 2.82266C7.15660 2.82266 5.49274 3.51185 4.26597 4.73862C3.03919 5.96540 2.35000 7.62926 2.35000 9.36417C2.35000 11.0991 3.03919 12.7630 4.26597 13.9897C5.49274 15.2165 7.15660 15.9057 8.89152 15.9057V15.9057ZM15.7819 14.713L19.6850 18.6161C19.7891 18.7167 19.8720 18.8371 19.9291 18.9701C19.9861 19.1032 20.0161 19.2463 20.0173 19.391C20.0184 19.5358 19.9907 19.6793 19.9358 19.8133C19.8809 19.9472 19.7999 20.0689 19.6974 20.1712C19.5950 20.2735 19.4732 20.3544 19.3392 20.4091C19.2052 20.4638 19.0616 20.4913 18.9168 20.4899C18.7720 20.4886 18.6290 20.4584 18.4960 20.4012C18.3631 20.3439 18.2428 20.2608 18.1423 20.1566L14.2392 16.2535C12.4866 17.614 10.2814 18.2554 8.07247 18.0472C5.86357 17.8390 3.81705 16.7968 2.34951 15.1328C0.881971 13.4688 0.103735 11.3080 0.173229 9.09044C0.242723 6.87284 1.15472 4.76508 2.72357 3.19623C4.29242 1.62738 6.40018 0.715379 8.61778 0.645885C10.8354 0.576391 12.9961 1.35463 14.6601 2.82217C16.3241 4.28971 17.3663 6.33623 17.5745 8.54513C17.7827 10.7540 17.1413 12.9592 15.7808 14.7119L15.7819 14.713Z" fill="#5A5252"/>
    </symbol>

    <symbol id="icon-filter" viewBox="0 0 23 22" fill="none">
        <path opacity="0.9" d="M21.5399 1.92871H1.37988L9.44388 11.4644V18.0567L13.4759 20.0727V11.4644L21.5399 1.92871Z" stroke="#1E1E1E" stroke-width="2.016" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol> 
     
    <!-- list -->
    <symbol id="list" viewBox="0 0 640 640" fill="currentColor">
        <path d="M112 208C138.5 208 160 186.5 160 160C160 133.5 138.5 112 112 112C85.5 112 64 133.5 64 160C64 186.5 85.5 208 112 208zM256 128C238.3 128 224 142.3 224 160C224 177.7 238.3 192 256 192L544 192C561.7 192 576 177.7 576 160C576 142.3 561.7 128 544 128L256 128zM256 288C238.3 288 224 302.3 224 320C224 337.7 238.3 352 256 352L544 352C561.7 352 576 337.7 576 320C576 302.3 561.7 288 544 288L256 288zM256 448C238.3 448 224 462.3 224 480C224 497.7 238.3 512 256 512L544 512C561.7 512 576 497.7 576 480C576 462.3 561.7 448 544 448L256 448zM112 528C138.5 528 160 506.5 160 480C160 453.5 138.5 432 112 432C85.5 432 64 453.5 64 480C64 506.5 85.5 528 112 528zM160 320C160 293.5 138.5 272 112 272C85.5 272 64 293.5 64 320C64 346.5 85.5 368 112 368C138.5 368 160 346.5 160 320z"/>
    </symbol> 
    <!-- card -->
    <symbol id="card" viewBox="0 0 640 640" fill="currentColor">
        <path d="M480 160L352 160L352 288L480 288L480 160zM544 288L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 160C96 124.7 124.7 96 160 96L480 96C515.3 96 544 124.7 544 160L544 288zM160 352L160 480L288 480L288 352L160 352zM288 288L288 160L160 160L160 288L288 288zM352 352L352 480L480 480L480 352L352 352z"/>
    </symbol>

</svg>
<script>
    const appPrefix = '/experts'; 

    // --- DOM Elements ---
    const gridViewBtn = document.getElementById('gridViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const expertGrid = document.getElementById('expertGrid');
    const expertList = document.getElementById('expertList');
    const expertListBody = document.getElementById('expertListBody');
    const expertPagination = document.getElementById('expertPagination');
    const loadingIndicator = document.getElementById('loadingIndicator');

    const collegeDropdownBtn = document.getElementById('collegeDropdownBtn');
    const collegeDropdownMenu = document.getElementById('collegeDropdownMenu');
    const currentFilterDisplay = document.getElementById('currentFilterDisplay');
    
    const expertSearchInput = document.getElementById('expertSearchInput');
    const expertFilterForm = document.getElementById('expertFilterForm');
    const hiddenSearchInput = document.getElementById('hiddenSearchInput');
    
    // AI Modals
    const generateTeamBtn = document.getElementById('generateTeamBtn');
    const aiInputModal = document.getElementById('aiInputModal');
    const aiPromptForm = document.getElementById('aiPromptForm');
    const teamResultsModal = document.getElementById('teamResultsModal');
    const closeInputModal = document.getElementById('closeInputModal');
    const closeResultsModal = document.getElementById('closeResultsModal');
    const modalBodyContent = document.getElementById('modalBodyContent');
    const confirmTeamsBtn = document.getElementById('confirmTeamsBtn');
    
    // --- State Variables ---
    let currentFilterKey = 'all'; 
    let currentFilterName = 'All Experts';
    let currentView = 'grid';
    let cachedExperts = []; 


    // --- Utility Functions ---
    function updateViewIcons(activeViewId) {
        if (activeViewId === 'grid') {
            document.getElementById('gridIconUse').setAttribute('href', '#icon-grid-active');
            document.getElementById('listIconUse').setAttribute('href', '#icon-list');
            gridViewBtn.classList.add('active');
            listViewBtn.classList.remove('active');
        } else {
            document.getElementById('gridIconUse').setAttribute('href', '#icon-grid');
            document.getElementById('listIconUse').setAttribute('href', '#icon-list-active');
            gridViewBtn.classList.remove('active');
            listViewBtn.classList.add('active');
        }
    }

    function switchView(view) {
        if (view === 'grid') {
            // FIX: Hide list, show grid
            expertList.classList.add('hidden');
            expertGrid.classList.remove('hidden'); 
            
            updateViewIcons('grid');
            currentView = 'grid';
            renderExpertCards(cachedExperts); 
        } else if (view === 'list') {
            // FIX: Hide grid, show list
            expertGrid.classList.add('hidden');
            expertList.classList.remove('hidden');
            
            updateViewIcons('list');
            currentView = 'list';
            renderExpertList(cachedExperts); 
        }
    }
    
    // --- Rendering Functions ---

    function renderExpertCards(experts) {
        expertGrid.innerHTML = '';
        if (experts.length === 0) {
            expertGrid.innerHTML = '<p style="width: 100%; text-align: center;">No experts found matching this filter.</p>';
            return;
        }

        experts.forEach(expert => {
            const card = document.createElement('a');
            card.className = 'expert-card';
            card.href = `${appPrefix}/${expert.id}/profile/`; 
            
            const campusTag = 'PalSU - '+expert.campus_display || 'Implementer';
            const collegeName = expert.college ? expert.college.name : 'N/A';
            const profileIconUrl = expert.profile_picture ? expert.profile_picture : `{% static 'users/profile_pictures/Default.png' %}`; 
            const collegeLogoPath = expert.college ? `{% static 'media/colleges/logos' %}/${expert.college.name}.png` : `{% static 'media/colleges/logos/Default.png' %}`;


            card.innerHTML = `
                <div class="campus-tag">${campusTag}</div>
                <img src="${collegeLogoPath}" class="college-logo-card" alt="${collegeName} Logo" onerror="this.onerror=null;this.src='{% static 'media/colleges/logos/Default.png' %}'">
                <img src="${profileIconUrl}" class="profile-icon" alt="${expert.full_name} Profile" onerror="this.onerror=null;this.src='{% static 'users/profile_pictures/Default.png' %}'">
                <div class="expert-name">${expert.full_name}</div>
                <div class="expert-expertise">${expert.expertise || 'General'}</div>
                <div class="expert-college">${expert.role_display} | ${collegeName}</div>
            `;
            expertGrid.appendChild(card);
        });
    }

    function renderExpertList(experts) {
        expertListBody.innerHTML = '';
        if (experts.length === 0) {
            expertListBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">No experts found matching this filter.</td></tr>`;
            return;
        }

        experts.forEach(expert => {
            const row = expertListBody.insertRow();
            const profileUrl = `${appPrefix}/${expert.id}/profile/`;
            
            row.innerHTML = `
                <td><a href="${profileUrl}">${expert.full_name}</a></td>
                <td>${expert.role_display}</td>
                <td>${expert.college ? expert.college.name : 'N/A'}</td>
                <td>${expert.expertise || 'None Defined'}</td>
                <td>${expert.campus_display || 'N/A'}</td>
                <td>${expert.contact_no}<br><small>${expert.email}</small></td>
            `;
        });
    }
    
    function renderPagination(jsonResponse) {
        expertPagination.classList.remove('hidden');
        expertPagination.innerHTML = '';
        
        const callback = 'loadExpertListPage'; 
        
        if (jsonResponse.previous) {
            const prevUrl = new URL(jsonResponse.previous);
            expertPagination.innerHTML += `<button class="pagination-button" onclick="event.preventDefault(); ${callback}('${prevUrl.search}');">Previous</button>`;
        }
        
        const totalPages = Math.ceil(jsonResponse.count / (jsonResponse.page_size || 12));
        expertPagination.innerHTML += `<span class="pagination-button active">Page ${jsonResponse.next ? parseInt(new URL(jsonResponse.next).searchParams.get('page')) - 1 : (jsonResponse.previous ? parseInt(new URL(jsonResponse.previous).searchParams.get('page')) + 1 : 1)} / ${totalPages}</span>`;

        if (jsonResponse.next) {
            const nextUrl = new URL(jsonResponse.next);
            expertPagination.innerHTML += `<button class="pagination-button" onclick="event.preventDefault(); ${callback}('${nextUrl.search}');">Next</button>`;
        }
    }


    // --- Data Fetching Logic ---
    
    async function fetchExpertData(url) {
        loadingIndicator.style.display = 'block';
        expertPagination.classList.add('hidden');
        expertGrid.innerHTML = ''; 
        expertListBody.innerHTML = ''; 
        
        try {
            const response = await fetch(url);
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Server returned status ${response.status}. Error: ${errorText}`);
            }
            const jsonResponse = await response.json();
            
            loadingIndicator.style.display = 'none';

            // Update cache with new data
            cachedExperts = jsonResponse.results || [];

            // Render the current active view using the new cached data
            switchView(currentView); // Renders either grid or list from cache
            
            // Render pagination
            if (jsonResponse.count > (jsonResponse.page_size || 12)) {
                renderPagination(jsonResponse);
            } else {
                expertPagination.classList.add('hidden');
            }
            
        } catch (error) {
            console.error("Error fetching expert data:", error);
            loadingIndicator.textContent = `Failed to load experts: ${error.message}`;
        } 
    }
    
    function loadExpertList(filterKey, filterName, queryString = '') {
        currentFilterKey = filterKey;
        currentFilterName = filterName;
        currentFilterDisplay.textContent = filterName;
        
        let apiPath = '';
        if (filterKey === 'all') {
            apiPath = `${appPrefix}/api/aggregate_experts/?${queryString}`;
        } else {
            apiPath = `${appPrefix}/api/experts/filter/${filterKey}/?${queryString}`;
        }
        
        fetchExpertData(apiPath);
    }
    
    function loadExpertListPage(queryString) {
        loadExpertList(currentFilterKey, currentFilterName, queryString.substring(1));
    }


    // --- AI Modal Logic ---

    if (generateTeamBtn) {
        generateTeamBtn.onclick = function() {
            aiInputModal.classList.remove('hidden');
        }
    }
    
    aiPromptForm.addEventListener('submit', function(e) {
        e.preventDefault();
        aiInputModal.classList.add('hidden');
        teamResultsModal.classList.remove('hidden');
        
        const topic = document.getElementById('aiTopic').value;
        const numMembers = document.getElementById('aiMembers').value;
        
        generateTeams(topic, numMembers);
    });

    closeInputModal.onclick = function() { aiInputModal.classList.add('hidden'); };
    closeResultsModal.onclick = function() { teamResultsModal.classList.add('hidden'); };
    window.onclick = function(event) {
        if (event.target == aiInputModal || event.target == teamResultsModal) {
            aiInputModal.classList.add('hidden');
            teamResultsModal.classList.add('hidden');
        }
    }
    
    async function generateTeams(topic, numMembers) {
        modalBodyContent.innerHTML = '<p id="loadingMessage">Generating teams, please wait...</p>';
        confirmTeamsBtn.classList.add('hidden');

        try {
            const response = await fetch(`${appPrefix}/api/generate_teams/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}' 
                },
                body: JSON.stringify({ num_members: numMembers, topic: topic })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || `Server returned status ${response.status}`);
            }

            const teams = await response.json();
            
            renderTeams(teams);

        } catch (error) {
            console.error("Team generation failed:", error);
            modalBodyContent.innerHTML = `<p style="color: red;">Error: ${error.message}. Please ensure the current user has DIRECTOR or VP privileges.</p>`;
        }
    }
    
    function renderTeams(teams) {
        let html = '';
        const team = teams[0]; 
        
        if (!team) {
            html = '<p>The AI could not form any teams with the available experts. Ensure you have eligible Faculty/Implementer users marked as experts with defined expertise.</p>';
        } else {
            const membersList = team.members.map(member => `
                <li>
                    <i class="fas fa-user-circle"></i> <strong>${member.name}</strong> (${member.role})
                    <br><small style="color: #555;">Expertise: ${member.expertise}</small>
                </li>
            `).join('');

            html = `
                <div class="team-card">
                    <h4>${team.team_name} (AI Score: ${team.ai_score} / 100)</h4>
                    <p style="margin-bottom: 10px;">**Rationale**: ${team.rationale}</p>
                    <strong>Members:</strong>
                    <ul style="list-style: none; padding-left: 10px;">
                        ${membersList}
                    </ul>
                </div>
            `;
            confirmTeamsBtn.classList.remove('hidden');
        }
        modalBodyContent.innerHTML = html;
    }


	// --- Initial Load & Event Handlers ---

	document.addEventListener('DOMContentLoaded', () => {
        updateViewIcons(currentView);
		loadExpertList('all', 'All Experts');
	});

	// FIX: Dropdown Logic
    collegeDropdownBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        collegeDropdownMenu.classList.toggle('hidden');
    });

    collegeDropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const filterKey = e.currentTarget.getAttribute('data-filter-key');
            const name = e.currentTarget.getAttribute('data-name');
            
            collegeDropdownMenu.classList.add('hidden');
            
            // Load the new filter set
            loadExpertList(filterKey, name);
        });
    });

    document.addEventListener('click', () => {
        collegeDropdownMenu.classList.add('hidden');
    });


    // FIX: View Toggle Handlers
    gridViewBtn.addEventListener('click', (e) => {
        e.preventDefault();
        switchView('grid'); 
    });
    listViewBtn.addEventListener('click', (e) => {
        e.preventDefault();
        switchView('list');
    });


    // Search and Sort Form Submission
    expertSearchInput.addEventListener('change', function() {
        hiddenSearchInput.value = this.value;
        expertFilterForm.dispatchEvent(new Event('submit'));
    });
    
    expertFilterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const queryString = new URLSearchParams(formData).toString();
        
        loadExpertList(currentFilterKey, currentFilterName, queryString);
    });
    
    // Back to Cards Button
	document.getElementById('backToCardsBtn').addEventListener('click', (e) => {
		e.preventDefault();
		switchView('grid');
	});

</script>

</body>
</html>
{% endblock %}