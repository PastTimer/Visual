{% extends "base_internal.html" %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pool of Experts</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/archive/styles.css' %}" rel="stylesheet"> 

<style>
	/* --- STYLES ADAPTED FROM ORIGINAL EXPERTS/PROFILE TEMPLATES --- */
	body {
		background-color: #F9F9F9;
		font-family: 'Inter', sans-serif;
		margin: 0;
		padding: 0;
	}

	.main-container {
		margin: 2rem 4rem 4rem 4rem; 
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.text-generate {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.title {
		font-size: 1.65rem; 
		font-weight: 500;
	}
    
    .generate-btn {
        width: 200px;
		height: 55px;
        background: #ff9900; 
		color: #fff;
		font-size: 1rem;
		font-weight: 500;
		border: none;
		border-radius: 8px;
		cursor: pointer;
        transition: background-color 0.2s ease;
		box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
	}
    .generate-btn:hover {
        background-color: #e68a00;
    }

	.search-bar {
        width: 100%;
		height: 2.75rem; 
		background: #fbfbfb;
		display: flex;
		align-items: center;
		padding: 0 16px;
		border-bottom: 1.09px solid #535353;
		border-radius: 8px;
		box-sizing: border-box;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.08); 
        position: relative;
	}
    
    .search-bar input {
        flex: 1;
        border: none;
        outline: none;
        background: transparent;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        color: #5A5252;
        padding: 0 10px;
    }
    
    /* Dropdown specific styles */
    .dropdown {
        position: relative;
        display: inline-block;
        margin-right: 10px;
    }

    .dropdown-btn {
        padding: 10px 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.2s ease;
        height: 2.75rem; 
    }
    .dropdown-btn:hover {
         border-color: #ff9900;
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 5px;
        width: 250px;
        background: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 10;
        overflow: hidden;
        max-height: 300px;
        overflow-y: auto;
    }

    .dropdown-item {
        padding: 10px 15px;
        cursor: pointer;
        transition: background 0.2s;
        font-family: 'Inter', sans-serif;
        font-size: 0.9rem;
        border-bottom: 1px solid #eee;
    }

    .dropdown-item:last-child {
        border-bottom: none;
    }

    .dropdown-item:hover {
        background-color: #f0f0f0;
    }

    /* View Buttons */
	.view-buttons {
		display: flex;
		gap: 10px;
        align-items: center;
	}

	.view-btn {
		display: flex;
		padding: 10px;
		width: 40px;
		height: 40px;
		border-radius: 8px;
		background: #F9F9F9;
		cursor: pointer;
		border: 1px solid #E5E7EB;
        transition: all 0.2s ease;
        justify-content: center;
        align-items: center;
	}
	
	.view-btn.active {
        background: #000000;
        color: #FFFFFF;
        border-color: #000000;
    }
    
    /* Content Layout */
    .expert-container {
		display: flex;
		flex-wrap: wrap;
		gap: 30px;
        margin-top: 20px;
	}

	/* Individual Expert Card - The requested style */
	.expert-card {
		width: 328px;
		height: auto;
		border: 0.8px solid rgba(0,0,0,0.1);
		border-radius: 12px;
		padding: 30px;
		display: flex;
		flex-direction: column;
		gap: 15px;
		background: #fff;
		position: relative;
        text-decoration: none;
        color: inherit;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        transition: all 0.2s ease;
	}
    
    .expert-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }

	.campus-tag {
		position: absolute;
		top: 10px;
		left: 10px;
		background: #F8A959;
		color: #4B331B;
		padding: 4px 8px;
		font-size: 14px;
		font-weight: 500;
        border-radius: 4px;
	}

	.college-logo-card {
		position: absolute;
		top: 10px;
		right: 10px;
		width: 60px;
		height: 60px;
		border-radius: 50%;
		object-fit: cover;
	}
    
    .profile-icon {
		width: 100px; 
		height: 100px;
		border-radius: 50%;
		background: #ddd;
		margin: 20px auto 10px auto;
        object-fit: cover;
	}

	.expert-name {
		text-align: center;
		font-size: 20px;
		font-weight: 500;
		color: #21272A;
	}

	.expert-expertise {
		text-align: center;
		font-size: 16px;
		color: #21272A;
		font-weight: 500;
	}

	.expert-college {
		text-align: center;
		font-size: 14px;
		color: #333;
	}
    
    /* List View Table */
    .expert-list {
		width: 100%;
        border-collapse: collapse;
        background: #FFFFFF; 
        border-radius: 8px; 
        box-shadow: 0 0 0 1px #dfdfdf, 0 0 15px rgba(0, 0, 0, 0.08); 
        margin-top: 20px;
	}
    
    .expert-list th, .expert-list td {
		border: none;
		border-bottom: 1px solid #E0E0E0; 
		padding: 14px 18px; 
		text-align: left;
		font-family: 'Inter', Arial, sans-serif;
	}

	.expert-list th {
		font-size: 0.95rem;
		font-weight: 600; 
		background: #eeeeee; 
		color: #333333; 
	}
    
    .expert-list td {
        font-size: 14px; 
        color: #555555; 
    }
    
    .expert-list tr:hover td {
        background-color: #f2f2f2;
    }

	.expert-list td a {
		text-decoration: none;
        color: #0099FF;
	}
    
    .expert-list td a:hover {
        text-decoration: underline;
    }

	/* Only use one class for hidden state management */
	.hidden { display: none !important; }
    
    /* AI MODAL STYLES */
    .modal {
        position: fixed; 
        z-index: 2000; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.4); 
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto; 
        padding: 30px;
        border: 1px solid #888;
        width: 80%; 
        max-width: 900px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .team-card {
        border: 1px solid #00681a;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 8px;
        background-color: #e6ffec; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .team-card h4 {
        margin-top: 0;
        color: #00681a;
        font-size: 1.15rem;
    }
    
    /* Custom AI Input Modal Style */
    #aiInputModal .modal-content {
        max-width: 450px;
    }
    #aiInputModal label {
        display: block;
        margin-top: 15px;
        font-weight: 600;
        color: #333;
    }
    #aiInputModal input {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
</style>

</head>
<body>
	<div class="main-container">

		<div class="text-generate">
			<div class="title">Pool of Experts</div>
			
            {% if can_generate_teams %}
			    <button id="generateTeamBtn" class="generate-btn">
                    <i class="fas fa-robot"></i> Generate AI Team
                </button>
            {% endif %}
		</div>

		<div class="search-and-controls">
			<div class="search-container" style="box-shadow: none;">
                
				<div class="dropdown">
                    <button class="dropdown-btn" id="collegeDropdownBtn">
                        <span id="currentFilterDisplay">All Experts</span> 
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-menu hidden" id="collegeDropdownMenu">
                        {% for option in dropdown_options %}
                            <div class="dropdown-item" data-filter-key="{{ option.filter_key }}" data-name="{{ option.name }}">
                                {{ option.name }} 
                                {% if not option.is_default %}({{ option.count|default:0 }}){% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
				<div class="search-bar">
                    <svg width="20" height="20"> <use href="#icon-search"></use> </svg>
					<input type="text" id="expertSearchInput" placeholder="Search name or expertise"/>
					<svg width="20" height="20" id="filterToggleBtn"> <use href="#icon-filter"></use> </svg>
				</div>

				<div class="view-buttons">
                    <button class="view-btn active" id="gridViewBtn" title="Grid View">
                        <svg width="28" height="28"><use id="gridIconUse" href="#icon-grid-active"></use></svg>
                    </button>
                    <button class="view-btn" id="listViewBtn" title="List View">
                        <svg width="28" height="28"><use id="listIconUse" href="#icon-list"></use></svg>
                    </button>
				</div>
			</div>
            
            <form id="expertFilterForm" class="hidden">
                 <input type="hidden" name="search" id="hiddenSearchInput" value="">
                 <select name="sort_by">
                    <option value="last_name">Last Name</option>
                    <option value="expertise">Expertise</option>
                    <option value="college__name">College</option>
                    <option value="campus">Campus</option>
                 </select>
                 <select name="order">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                 </select>
            </form>
		</div>

		<div id="contentArea">
            
            <div class="expert-container" id="expertGrid">
                <p id="loadingIndicator" style="width: 100%; text-align: center;">Loading experts...</p>
            </div>

            <table class="expert-list hidden" id="expertList">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>College</th>
                    <th>Expertise</th>
                    <th>Campus</th>
                    <th>Contact/Email</th>
                </tr>
            </thead>
            <tbody id="expertListBody">
            </tbody>
            </table>
            
            <div class="pagination hidden" id="expertPagination">
            </div>
            
		</div>

	</div>

    <div id="aiInputModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" id="closeInputModal">&times;</span>
            <h2 style="color: #00681a;"><i class="fas fa-search"></i> AI Team Requirements</h2>
            <form id="aiPromptForm">
                <label for="aiTopic">Expertise/Topic Required:</label>
                <input type="text" id="aiTopic" name="topic" placeholder="e.g., Beekeeping, Data Analysis" required>
                
                <label for="aiMembers">Number of Team Members:</label>
                <input type="number" id="aiMembers" name="num_members" value="4" min="1" required>
                
                <div style="text-align: right; margin-top: 20px;">
                    <button type="submit" class="generate-btn" style="width: auto; padding: 10px 20px;">
                        Analyze & Generate Team
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="teamResultsModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" id="closeResultsModal">&times;</span>
            <h2 style="color: #00681a;"><i class="fas fa-robot"></i> AI Team Generation Results</h2>
            <div id="modalBodyContent">
                <p id="loadingMessage">Generating teams, please wait...</p>
            </div>
            <div id="modalFooter" style="text-align: right; margin-top: 20px;">
                 <button id="confirmTeamsBtn" class="filter-apply hidden" style="background-color: #00681a;">
                    Confirm & Save Teams
                </button>
            </div>
        </div>
    </div>
    
<script>
    const appPrefix = '/experts'; 

    // --- DOM Elements ---
    const gridViewBtn = document.getElementById('gridViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const expertGrid = document.getElementById('expertGrid');
    const expertList = document.getElementById('expertList');
    const expertListBody = document.getElementById('expertListBody');
    const expertPagination = document.getElementById('expertPagination');
    const loadingIndicator = document.getElementById('loadingIndicator');

    const collegeDropdownBtn = document.getElementById('collegeDropdownBtn');
    const collegeDropdownMenu = document.getElementById('collegeDropdownMenu');
    const currentFilterDisplay = document.getElementById('currentFilterDisplay');
    
    const expertSearchInput = document.getElementById('expertSearchInput');
    const expertFilterForm = document.getElementById('expertFilterForm');
    const hiddenSearchInput = document.getElementById('hiddenSearchInput');
    
    // AI Modals
    const generateTeamBtn = document.getElementById('generateTeamBtn');
    const aiInputModal = document.getElementById('aiInputModal');
    const aiPromptForm = document.getElementById('aiPromptForm');
    const teamResultsModal = document.getElementById('teamResultsModal');
    const closeInputModal = document.getElementById('closeInputModal');
    const closeResultsModal = document.getElementById('closeResultsModal');
    const modalBodyContent = document.getElementById('modalBodyContent');
    const confirmTeamsBtn = document.getElementById('confirmTeamsBtn');
    
    // --- State Variables ---
    let currentFilterKey = 'all'; 
    let currentFilterName = 'All Experts';
    let currentView = 'grid';
    let cachedExperts = []; 


    // --- Utility Functions ---
    function updateViewIcons(activeViewId) {
        if (activeViewId === 'grid') {
            document.getElementById('gridIconUse').setAttribute('href', '#icon-grid-active');
            document.getElementById('listIconUse').setAttribute('href', '#icon-list');
            gridViewBtn.classList.add('active');
            listViewBtn.classList.remove('active');
        } else {
            document.getElementById('gridIconUse').setAttribute('href', '#icon-grid');
            document.getElementById('listIconUse').setAttribute('href', '#icon-list-active');
            gridViewBtn.classList.remove('active');
            listViewBtn.classList.add('active');
        }
    }

    function switchView(view) {
        if (view === 'grid') {
            // FIX: Hide list, show grid
            expertList.classList.add('hidden');
            expertGrid.classList.remove('hidden'); 
            
            updateViewIcons('grid');
            currentView = 'grid';
            renderExpertCards(cachedExperts); 
        } else if (view === 'list') {
            // FIX: Hide grid, show list
            expertGrid.classList.add('hidden');
            expertList.classList.remove('hidden');
            
            updateViewIcons('list');
            currentView = 'list';
            renderExpertList(cachedExperts); 
        }
    }
    
    // --- Rendering Functions ---

    function renderExpertCards(experts) {
        expertGrid.innerHTML = '';
        if (experts.length === 0) {
            expertGrid.innerHTML = '<p style="width: 100%; text-align: center;">No experts found matching this filter.</p>';
            return;
        }

        experts.forEach(expert => {
            const card = document.createElement('a');
            card.className = 'expert-card';
            card.href = `${appPrefix}/${expert.id}/profile/`; 
            
            const campusTag = expert.campus_display || 'N/A';
            const collegeName = expert.college ? expert.college.name : 'N/A';
            const profileIconUrl = expert.profile_picture ? expert.profile_picture : `{% static 'users/profile_pictures/Default.png' %}`; 
            const collegeLogoPath = expert.college ? `{% static 'media/colleges/logos' %}/${expert.college.name}.png` : `{% static 'media/colleges/logos/Default.png' %}`;


            card.innerHTML = `
                <div class="campus-tag">${campusTag}</div>
                <img src="${collegeLogoPath}" class="college-logo-card" alt="${collegeName} Logo" onerror="this.onerror=null;this.src='{% static 'media/colleges/logos/Default.png' %}'">
                <img src="${profileIconUrl}" class="profile-icon" alt="${expert.full_name} Profile" onerror="this.onerror=null;this.src='{% static 'users/profile_pictures/Default.png' %}'">
                <div class="expert-name">${expert.full_name}</div>
                <div class="expert-expertise">${expert.expertise || 'General'}</div>
                <div class="expert-college">${expert.role_display} | ${collegeName}</div>
            `;
            expertGrid.appendChild(card);
        });
    }

    function renderExpertList(experts) {
        expertListBody.innerHTML = '';
        if (experts.length === 0) {
            expertListBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">No experts found matching this filter.</td></tr>`;
            return;
        }

        experts.forEach(expert => {
            const row = expertListBody.insertRow();
            const profileUrl = `${appPrefix}/${expert.id}/profile/`;
            
            row.innerHTML = `
                <td><a href="${profileUrl}">${expert.full_name}</a></td>
                <td>${expert.role_display}</td>
                <td>${expert.college ? expert.college.name : 'N/A'}</td>
                <td>${expert.expertise || 'None Defined'}</td>
                <td>${expert.campus_display || 'N/A'}</td>
                <td>${expert.contact_no}<br><small>${expert.email}</small></td>
            `;
        });
    }
    
    function renderPagination(jsonResponse) {
        expertPagination.classList.remove('hidden');
        expertPagination.innerHTML = '';
        
        const callback = 'loadExpertListPage'; 
        
        if (jsonResponse.previous) {
            const prevUrl = new URL(jsonResponse.previous);
            expertPagination.innerHTML += `<button class="pagination-button" onclick="event.preventDefault(); ${callback}('${prevUrl.search}');">Previous</button>`;
        }
        
        const totalPages = Math.ceil(jsonResponse.count / (jsonResponse.page_size || 12));
        expertPagination.innerHTML += `<span class="pagination-button active">Page ${jsonResponse.next ? parseInt(new URL(jsonResponse.next).searchParams.get('page')) - 1 : (jsonResponse.previous ? parseInt(new URL(jsonResponse.previous).searchParams.get('page')) + 1 : 1)} / ${totalPages}</span>`;

        if (jsonResponse.next) {
            const nextUrl = new URL(jsonResponse.next);
            expertPagination.innerHTML += `<button class="pagination-button" onclick="event.preventDefault(); ${callback}('${nextUrl.search}');">Next</button>`;
        }
    }


    // --- Data Fetching Logic ---
    
    async function fetchExpertData(url) {
        loadingIndicator.style.display = 'block';
        expertPagination.classList.add('hidden');
        expertGrid.innerHTML = ''; 
        expertListBody.innerHTML = ''; 
        
        try {
            const response = await fetch(url);
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Server returned status ${response.status}. Error: ${errorText}`);
            }
            const jsonResponse = await response.json();
            
            loadingIndicator.style.display = 'none';

            // Update cache with new data
            cachedExperts = jsonResponse.results || [];

            // Render the current active view using the new cached data
            switchView(currentView); // Renders either grid or list from cache
            
            // Render pagination
            if (jsonResponse.count > (jsonResponse.page_size || 12)) {
                renderPagination(jsonResponse);
            } else {
                expertPagination.classList.add('hidden');
            }
            
        } catch (error) {
            console.error("Error fetching expert data:", error);
            loadingIndicator.textContent = `Failed to load experts: ${error.message}`;
        } 
    }
    
    function loadExpertList(filterKey, filterName, queryString = '') {
        currentFilterKey = filterKey;
        currentFilterName = filterName;
        currentFilterDisplay.textContent = filterName;
        
        let apiPath = '';
        if (filterKey === 'all') {
            apiPath = `${appPrefix}/api/aggregate_experts/?${queryString}`;
        } else {
            apiPath = `${appPrefix}/api/experts/filter/${filterKey}/?${queryString}`;
        }
        
        fetchExpertData(apiPath);
    }
    
    function loadExpertListPage(queryString) {
        loadExpertList(currentFilterKey, currentFilterName, queryString.substring(1));
    }


    // --- AI Modal Logic ---

    if (generateTeamBtn) {
        generateTeamBtn.onclick = function() {
            aiInputModal.classList.remove('hidden');
        }
    }
    
    aiPromptForm.addEventListener('submit', function(e) {
        e.preventDefault();
        aiInputModal.classList.add('hidden');
        teamResultsModal.classList.remove('hidden');
        
        const topic = document.getElementById('aiTopic').value;
        const numMembers = document.getElementById('aiMembers').value;
        
        generateTeams(topic, numMembers);
    });

    closeInputModal.onclick = function() { aiInputModal.classList.add('hidden'); };
    closeResultsModal.onclick = function() { teamResultsModal.classList.add('hidden'); };
    window.onclick = function(event) {
        if (event.target == aiInputModal || event.target == teamResultsModal) {
            aiInputModal.classList.add('hidden');
            teamResultsModal.classList.add('hidden');
        }
    }
    
    async function generateTeams(topic, numMembers) {
        modalBodyContent.innerHTML = '<p id="loadingMessage">Generating teams, please wait...</p>';
        confirmTeamsBtn.classList.add('hidden');

        try {
            const response = await fetch(`${appPrefix}/api/generate_teams/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}' 
                },
                body: JSON.stringify({ num_members: numMembers, topic: topic })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || `Server returned status ${response.status}`);
            }

            const teams = await response.json();
            
            renderTeams(teams);

        } catch (error) {
            console.error("Team generation failed:", error);
            modalBodyContent.innerHTML = `<p style="color: red;">Error: ${error.message}. Please ensure the current user has DIRECTOR or VP privileges.</p>`;
        }
    }
    
    function renderTeams(teams) {
        let html = '';
        const team = teams[0]; 
        
        if (!team) {
            html = '<p>The AI could not form any teams with the available experts. Ensure you have eligible Faculty/Implementer users marked as experts with defined expertise.</p>';
        } else {
            const membersList = team.members.map(member => `
                <li>
                    <i class="fas fa-user-circle"></i> <strong>${member.name}</strong> (${member.role})
                    <br><small style="color: #555;">Expertise: ${member.expertise}</small>
                </li>
            `).join('');

            html = `
                <div class="team-card">
                    <h4>${team.team_name} (AI Score: ${team.ai_score} / 100)</h4>
                    <p style="margin-bottom: 10px;">**Rationale**: ${team.rationale}</p>
                    <strong>Members:</strong>
                    <ul style="list-style: none; padding-left: 10px;">
                        ${membersList}
                    </ul>
                </div>
            `;
            confirmTeamsBtn.classList.remove('hidden');
        }
        modalBodyContent.innerHTML = html;
    }


	// --- Initial Load & Event Handlers ---

	document.addEventListener('DOMContentLoaded', () => {
        updateViewIcons(currentView);
		loadExpertList('all', 'All Experts');
	});

	// FIX: Dropdown Logic
    collegeDropdownBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        collegeDropdownMenu.classList.toggle('hidden');
    });

    collegeDropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const filterKey = e.currentTarget.getAttribute('data-filter-key');
            const name = e.currentTarget.getAttribute('data-name');
            
            collegeDropdownMenu.classList.add('hidden');
            
            // Load the new filter set
            loadExpertList(filterKey, name);
        });
    });

    document.addEventListener('click', () => {
        collegeDropdownMenu.classList.add('hidden');
    });


    // FIX: View Toggle Handlers
    gridViewBtn.addEventListener('click', (e) => {
        e.preventDefault();
        switchView('grid'); 
    });
    listViewBtn.addEventListener('click', (e) => {
        e.preventDefault();
        switchView('list');
    });


    // Search and Sort Form Submission
    expertSearchInput.addEventListener('change', function() {
        hiddenSearchInput.value = this.value;
        expertFilterForm.dispatchEvent(new Event('submit'));
    });
    
    expertFilterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const queryString = new URLSearchParams(formData).toString();
        
        loadExpertList(currentFilterKey, currentFilterName, queryString);
    });
    
    // Back to Cards Button
	document.getElementById('backToCardsBtn').addEventListener('click', (e) => {
		e.preventDefault();
		switchView('grid');
	});

</script>

</body>
</html>
{% endblock %}