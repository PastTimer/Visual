{% extends "base_internal.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Downloadable</title>

<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

<style>
    .success-message {
		color: green; 
		margin-bottom: 1rem;
	}

    .error-input {
        border-color: #E53E3E !important;
        background: #FFF5F5 !important;
    }

    span.required {
        color: #e53e3e;
    }

    body {
        background: #F9F9F9;
        margin: 0;
        font-family: 'Inter', Arial, sans-serif;
    }

    .main-container {
        margin: 60px;
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

	.form-title {
		font-family: 'Inter', Arial, sans-serif;
        font-weight: 400;
        font-size: 32px;
		margin: 0;
		color: #000000;
	}

    .downloadable-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

	.form-group {
		display: flex;
		align-items: flex-start;
		gap: 1rem;
	}

	.form-label {
		font-weight: 600;
		color: #374151;
		padding-top: 0.75rem;
		font-size: 0.95rem;
	}

	.upload-area {
		flex: 1;
		border: 2px dashed #E5E7EB;
		border-radius: 8px;
		padding: 2rem;
		text-align: center;
		background: #F9F9F9;
		cursor: pointer;
		transition: all 0.2s ease;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 0.5rem;
	}

    .upload-area:hover {
        border-color: #0A6C44;
        background: #F0FDF4;
    }

    .upload-icon {
        width: 24px;
        height: 24px;
        color: #4B5563;
    }

    .upload-text {
        color: #4B5563;
        font-size: 0.95rem;
    }

    .file-preview {
        margin-top: 1rem;
        padding: 1rem;
        background: #F0FDF4;
        border: 1px solid #BBF7D0;
        border-radius: 8px;
        display: none;
    }

    .file-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #1f7c57;
        font-size: 0.95rem;
    }

    .checkbox-row {
        display: flex;
        align-items: center;
        gap: 10px;
        align-self: flex-start;
        margin-top: 0.5rem;
    }

	.form-actions {
		display: flex;
		gap: 1rem;
		justify-content: flex-end;
		margin-top: 2rem;
		padding-top: 1.5rem;
		border-top: 1px solid #E5E7EB;
	}

    .back-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Inter', sans-serif;
		background: #6B7280;
		color: white;
        text-decoration: none;
    }

    .back-btn:hover {
		background: #4B5563;
		transform: translateY(-1px);
    }
    
    .submit-btn {
		padding: 0.75rem 1.5rem;
		border: none;
		border-radius: 8px;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.2s ease;
		font-family: 'Inter', sans-serif;
		background: #0A6C44;
		color: white;
    }

    .submit-btn:hover {
        background: #1f7c57;
		transform: translateY(-1px);
    }

    .error-message {
        color: #E53E3E;
        font-size: 1rem;
        margin-bottom: 1rem;
        text-align: center;
    }

    select {
		appearance: none;
		-webkit-appearance: none;
		-moz-appearance: none;
		padding-right: 2rem;
		background: url("data:image/svg+xml;utf8,<svg width='16' height='11' viewBox='0 0 16 11' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M7.99976 7.19417L13.9025 1.29147C14.0125 1.17758 14.144 1.08674 14.2895 1.02424C14.435 0.961746 14.5915 0.92885 14.7498 0.927474C14.9082 0.926098 15.0652 0.95627 15.2117 1.01623C15.3583 1.07619 15.4914 1.16473 15.6034 1.27669C15.7153 1.38866 15.8039 1.5218 15.8638 1.66835C15.9238 1.8149 15.954 1.97192 15.9526 2.13026C15.9512 2.28859 15.9183 2.44506 15.8558 2.59055C15.7933 2.73604 15.7025 2.86762 15.5886 2.97762L8.84283 9.72339C8.61921 9.94694 8.31596 10.0725 7.99976 10.0725C7.68356 10.0725 7.38031 9.94694 7.15669 9.72339L0.41092 2.97762C0.297028 2.86762 0.206183 2.73604 0.143687 2.59055C0.0811915 2.44506 0.0482959 2.28859 0.04692 2.13026C0.0455441 1.97192 0.0757155 1.8149 0.135674 1.66835C0.195632 1.5218 0.284176 1.38866 0.39614 1.27669C0.508103 1.16473 0.641244 1.07619 0.787794 1.01623C0.934343 0.95627 1.09137 0.926098 1.2497 0.927474C1.40804 0.92885 1.56451 0.961746 1.71 1.02424C1.85548 1.08674 1.98706 1.17758 2.09706 1.29147L7.99976 7.19417Z' fill='%23374151'/></svg>")
        		no-repeat right 0.75rem center;
  		background-size: 13px 8px;
        font-family: 'Inter', Arial, sans-serif;
        font-weight: 400;
    }
</style>

</head>
<body>
    <div class="main-container">
        <h1 class="form-title">Add Downloadable</h1>

        {% if success %}
            <div class="success-message">Downloadable added successfully!</div>
        {% endif %}
        {% if error %}
            <div class="error-message">{{ error }}</div>
        {% endif %}

        <form class="downloadable-form" method="post" enctype="multipart/form-data" id="downloadable-form" action="{% url 'add_downloadable' %}">
            {% csrf_token %}
            <div class="form-group">
                <label class="form-label" for="id_file">Attach File <span class="required">*</span></label>
                <div class="upload-area" onclick="document.getElementById('id_file').click()">
                    <svg class="upload-icon"><use href="#icon-upload"></use></svg>
                    <span class="upload-text">Click to upload</span>
                    <input class="file-input" type="file" name="file" id="id_file" style="display:none;" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
                </div>
            </div>
            <div class="file-preview" id="file-preview" style="display:none;">
                <div class="file-info">
                    <svg width="16" height="16"><use href="#icon-upload"></use></svg>
                    <span id="file-name"></span>
                </div>
            </div>
            <div class="checkbox-row">
                <input type="checkbox" id="id_available_for_non_users" name="available_for_non_users" style="width:18px;height:18px;">
                <label for="id_available_for_non_users" style="font-size:1rem;color:#245F3E;cursor:pointer;">Available for the public</label>
            </div>
            <div class="checkbox-row" id="submission-template-row" style="display:none;">
                <input type="checkbox" id="id_is_submission_template" name="is_submission_template" style="width:18px;height:18px;">
                <label for="id_is_submission_template" style="font-size:1rem;color:#245F3E;cursor:pointer;">Submission Template</label>
            </div>
            <div class="form-group" id="submission-type-row" style="display:none;">
                <label class="form-label" for="id_submission_type">Submission Type</label>
                <select id="id_submission_type" name="submission_type" style="flex:1;padding:0.75rem;border-radius:8px;border:1px solid #e5e7eb;font-size:1rem;">
                    {% for value, label in submission_type_choices %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-actions">
                <a href="{% url 'downloadable_dispatcher' %}" class="back-btn">Back</a>
                <button type="submit" class="submit-btn" id="submit-btn">Submit</button>
            </div>
        </form>
    </div>

<!-- SVG Sprite Section -->
<svg style="display:none;">

    <!-- Upload Icon -->
    <symbol id="icon-upload" viewBox="0 0 24 24" fill="currentColor">
        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
        <path d="M12,11L8,15H16L12,11Z" />
    </symbol>

</svg>

<script>
    // File Input Change Handler
    document.getElementById('id_file').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const fileInput = document.getElementById('id_file');
        const fileError = document.getElementById('file-error');
        fileInput.classList.remove('error-input');
        if (file) {
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-preview').style.display = 'block';
            fileError.style.display = 'none';
        } else {
            document.getElementById('file-preview').style.display = 'none';
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Dynamic show/hide logic for submission template and type
        var availableForNonUsers = document.getElementById('id_available_for_non_users');
        var submissionTemplateRow = document.getElementById('submission-template-row');
        var isSubmissionTemplate = document.getElementById('id_is_submission_template');
        var submissionTypeRow = document.getElementById('submission-type-row');

        function updateSubmissionTemplateVisibility() {
            if (availableForNonUsers.checked) {
                submissionTemplateRow.style.display = 'none';
                isSubmissionTemplate.checked = false;
                submissionTypeRow.style.display = 'none';
            } else {
                submissionTemplateRow.style.display = '';
                if (isSubmissionTemplate.checked) {
                    submissionTypeRow.style.display = '';
                } else {
                    submissionTypeRow.style.display = 'none';
                }
            }
        }
        availableForNonUsers.addEventListener('change', updateSubmissionTemplateVisibility);
        isSubmissionTemplate.addEventListener('change', updateSubmissionTemplateVisibility);
        updateSubmissionTemplateVisibility();

        // Global error catcher for form submission
        var form = document.getElementById('downloadable-form');
        if (form) {
            form.addEventListener('submit', function(e) {
                let valid = true;
                const fields = Array.from(form.querySelectorAll('input'));
                fields.forEach(field => {
                    field.classList.remove('error-input');
                    let err = document.getElementById(field.name + '-error');
                    if (err) err.remove();
                });

                function removeError(tagRow, errorId) {
                    let err = document.getElementById(errorId);
                    if (err) err.remove();
                    if (tagRow) tagRow.classList.remove('error-input');
                }

                removeError(document.getElementById('file-error'), 'file-error');

                var fileInput = document.getElementById('id_file');
                var fileSelected = fileInput && fileInput.files && fileInput.files.length > 0;
                if (!fileSelected) {
                    valid = false;
                    fileInput.classList.add('error-input');
                    let err = document.createElement('div');
                    err.id = 'file-error';
                    err.textContent = 'File is required.';
                    err.style.color = '#E53E3E';
                    err.style.fontSize = '0.95rem';
                    err.style.marginTop = '0.25rem';
                    fileInput.parentNode.appendChild(err);
                }

                if (!valid) {
                    e.preventDefault();
                    return;
                }
            });
        }
    });
</script>

</body>
</html>

{% endblock %}