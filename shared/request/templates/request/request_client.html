{% extends "base_public.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Requests</title>

<link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700,800&display=swap" rel="stylesheet">

<!-- General -->
<style>
    body {
        background: #F9F9F9;
        font-family: 'Inter', sans-serif;
    }

	main {
		display: flex;
		flex-direction: row;
		gap: 70px;
		margin: 70px;
		justify-content: space-between;
	}

	h2 {
		font-size: 1.75rem;
		font-weight: 500;
	}

	.hidden {
		display: none;
	}
</style>

<!-- Left -->
<style>
	.widgets {
		background-color: white;
		border-radius: 1rem;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
		padding: 20px;
		max-height: 650px;
		display: flex;
		flex-direction: column;
		gap: 30px; 
		min-width: 270px;
	}

	.widgets-header {
		padding: 20px 20px 0 20px;
		display: flex;
		align-items: center;
		height: 4rem; 
	}  

	.widgets button {
		border: 0.11rem solid #262626;
		border-radius: 5rem;
		padding: 0.5rem 1rem;
		font-size: 1rem;
		font-weight: 400; 
		height: 3rem;
		cursor: pointer;
		transition: all 0.2s ease;
		background-color: white;
		color: #262626;
	}

	.widgets button:hover {
		background-color: #5b5b5b;
		color: white; 
	}

	.widgets button.active {
		background-color: #262626;
		color: white; 
	} 
</style>

<!-- Right -->
<style>
	.list {
		background-color: white;
		border-radius: 1rem;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
		padding: 50px;
		height: auto;
		display: flex;
		flex-direction: column;
		gap: 30px; 
		width: 100%;
	}

	.add-request-btn {
		background: #063A1C;
		color: white;
		padding: 15px 45px;
		border-radius: 8px;
		font-size: 20px;
		font-family: 'Inter', sans-serif;
        font-weight: 500;
		cursor: pointer;
		transition: all 0.2s ease;
		box-shadow: 0 2px 8px rgba(10, 108, 68, 0.2);
		text-decoration: none;
        border-radius: 18px;
        cursor: pointer;
        transition: background 0.2s;
	}   

	.add-request-btn:hover {
		background: #04521c;
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(10, 108, 68, 0.3);
		text-decoration: none;
		color: white;
	}

	.files-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		height: 4rem;
	}

	.files-header > div {
		display: flex;
		align-items: center; 
	}

	.files-header h2 {
		margin: 0;       
		line-height: 1;   
	}

	.list-holder {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		height: auto;  /* Make sure height is auto */
	}

	.list-item {
		background: #E6F2FB;
		border-radius: 1rem;
		padding: 1rem 1.5rem;
		box-shadow: 0 2px 5px rgba(0,0,0,0.15);
	}

	.status-counts {
		display: flex;
		gap: 2rem;
		margin-bottom: 1rem;
		padding: 0 1rem;
	}
	
	.status-count {
		font-size: 1.25rem;
		display: flex;
		align-items: baseline;
		gap: 0.5rem;
	}

	.status-count .number {
		font-size: 1.6rem;
		font-weight: 700;
	}

	.status-count .label {
		font-weight: 400;
	}
</style>

<!-- Search Bar Styles -->
<style>
	.search-container {
		width: 100%;
		display: flex;
		gap: 10px;
	}

	.search-bar {
		width: 100%;
		height: 52px;
		background: #F2F4F8;
		display: flex;
		align-items: center;
		padding: 0 16px;
		border-bottom: 1.09px solid #535353;
		border-radius: 8px;
		box-sizing: border-box;
	}

	.search-bar input {
		flex: 1;
		border: none;
		outline: none;
		background: transparent;
		font-size: 18px;
		font-family: 'Inter', sans-serif;
		font-weight: 400;
		color: #5A5252;
		padding: 0 10px;
	}
</style>

<!-- Sort/Filter Styles -->
<style>
	.filter-dropdown {
		display: none;
		position: absolute;
		top: 420px;
		right: 120px;
		z-index: 1000;
		background: white;
		border: 1px solid #e5e7eb;
		border-radius: 12px;
		box-shadow: 0 8px 32px rgba(0,0,0,0.18);
		padding: 24px 32px;
		min-width: 340px;
	}

	.filter-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		grid-gap: 24px;
	}

	.filter-dropdown label {
		font-weight: 500;
		color: #374151;
		display: flex;
		flex-direction: column;
	}

	.filter-dropdown select,
	.filter-dropdown input[type="date"] {
		width: 100%;
		margin-top: 6px;
		border: 1px solid #e5e7eb;
		border-radius: 6px;
		padding: 6px 10px;
		font-size: 15px;
		font-family: 'Inter', sans-serif;
		background: #f9f9f9;
		color: #374151;
	}

	.filter-dropdown select {
		appearance: none;
		-webkit-appearance: none;
		-moz-appearance: none;
		padding-right: 2rem;
		background: url("data:image/svg+xml;utf8,<svg width='16' height='11' viewBox='0 0 16 11' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M7.99976 7.19417L13.9025 1.29147C14.0125 1.17758 14.144 1.08674 14.2895 1.02424C14.435 0.961746 14.5915 0.92885 14.7498 0.927474C14.9082 0.926098 15.0652 0.95627 15.2117 1.01623C15.3583 1.07619 15.4914 1.16473 15.6034 1.27669C15.7153 1.38866 15.8039 1.5218 15.8638 1.66835C15.9238 1.8149 15.954 1.97192 15.9526 2.13026C15.9512 2.28859 15.9183 2.44506 15.8558 2.59055C15.7933 2.73604 15.7025 2.86762 15.5886 2.97762L8.84283 9.72339C8.61921 9.94694 8.31596 10.0725 7.99976 10.0725C7.68356 10.0725 7.38031 9.94694 7.15669 9.72339L0.41092 2.97762C0.297028 2.86762 0.206183 2.73604 0.143687 2.59055C0.0811915 2.44506 0.0482959 2.28859 0.04692 2.13026C0.0455441 1.97192 0.0757155 1.8149 0.135674 1.66835C0.195632 1.5218 0.284176 1.38866 0.39614 1.27669C0.508103 1.16473 0.641244 1.07619 0.787794 1.01623C0.934343 0.95627 1.09137 0.926098 1.2497 0.927474C1.40804 0.92885 1.56451 0.961746 1.71 1.02424C1.85548 1.08674 1.98706 1.17758 2.09706 1.29147L7.99976 7.19417Z' fill='%23374151'/></svg>")
        		no-repeat right 0.75rem center;
  		background-size: 13px 8px;
	}

	.filter-actions {
		display: flex;
		justify-content: flex-end;
		gap: 10px;
		margin-top: 24px;
	}

	.filter-apply {
		background: #063A1C;
		color: white;
		padding: 10px 28px;
		border-radius: 8px;
		font-size: 16px;
		font-family: 'Inter', sans-serif;
		font-weight: 500;
		cursor: pointer;
		transition: background 0.2s;
		border: none;
	}

	.filter-close {
		background: #e5e7eb;
		color: #374151;
		padding: 10px 18px;
		border-radius: 8px;
		font-size: 16px;
		font-family: 'Inter', sans-serif;
		font-weight: 500;
		cursor: pointer;
		border: none;
	}

	.search-bar > input[type="text"] {
		border: none;
	}
</style>

<!-- Table Section -->
<style>
    .table {
        width: 100%;
        border-collapse: collapse;
        background: #FEFCFC;
        border: 1px solid rgba(0,0,0,0.18);
        overflow: visible;
    }

    .table th {
        font-size: 16px;
        font-weight: 500;
        background: rgba(217, 217, 217, 0.2);
        border-bottom: 1px solid rgba(0,0,0,0.18);
        padding: 14px 12px;
        text-align: left;
        font-family: 'Inter', Arial, sans-serif;
    }

    .table td {
        font-size: 15px;
        font-weight: 400;
        border: none;
        border-bottom: 1px solid rgba(0,0,0,0.18);
        padding: 14px 12px;
        text-align: left;
        font-family: 'Inter', Arial, sans-serif;
        position: relative;
        overflow: visible;
    }

    .table tr:last-child td {
        border-bottom: none;
    }

    .settings-icon {
        width: 16px;
        height: 16px;
        align-items: center;
        justify-content: center;
        display: inline-block;
        vertical-align: middle;
        cursor: pointer;
    }

    .table th.settings-col, .table td.settings-col {
        text-align: center !important;
    }
</style>

<!-- Pagination Styles -->
<style>
	.pagination-container {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 0.5rem;
	}

	.pagination-button {
		padding: 0.75rem 1rem;
		border: 1px solid #E5E7EB;
		background: white;
		color: #4B5563;
		border-radius: 8px;
		cursor: pointer;
		transition: all 0.2s ease;
		font-weight: 500;
		text-decoration: none;
	}

	.pagination-button:hover {
		background: #F3F4F6;
		border-color: #0A6C44;
		color: #0A6C44;
	}

	.pagination-button.active {
		background: #0A6C44;
		color: white;
		border-color: #0A6C44;
	}

	.pagination-button:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.page-info {
		margin: 0 1rem;
		color: #4B5563;
		font-weight: 500;
	}
</style>

</head>

<body>

<main>
	<div class="widgets">
		<div class="widgets-header">
			<h2>My Updates</h2>
		</div>
		<div class="my-updates-list">
			{% if my_updates %}
				<ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:25px;max-height:500px;overflow-y:auto;">
				{% for update in my_updates %}
					<li>
						<a href="{% url 'request_details_dispatcher' update.request_id %}"
						   class="my-update-link{% if not update.viewed %} my-update-unviewed{% endif %} my-update-block">
							<div>
								{{ update.message }}
								<div style="font-size:0.95em;color:#888;margin-top:8px;">
									{{ update.updated_at|date:'M d, Y H:i' }}
									{% if not update.viewed %}
										<span style="background:#E37910;color:white;border-radius:8px;padding:2px 8px;font-size:0.8em;margin-left:8px;">New</span>
									{% endif %}
								</div>
							</div>
						</a>
					</li>
				{% endfor %}
				</ul>
				<style>
				.my-update-link {
					color: #000000;
					text-decoration: none;
					font-weight: 400;
				}
				.my-update-link.my-update-unviewed {
					font-weight: 700;
				}
				.my-update-block {
					display: block;
					padding: 8px 10px;
					border-radius: 8px;
					transition: background 0.15s;
				}
				.my-update-block:hover {
					background: #f3f4f6;
					text-decoration: none;
				}
				.my-updates-list ul::-webkit-scrollbar {
					width: 8px;
				}
				.my-updates-list ul::-webkit-scrollbar-thumb {
					background: #e5e7eb;
					border-radius: 6px;
				}
				.my-updates-list ul {
					scrollbar-width: thin;
					scrollbar-color: #e5e7eb #fff;
				}
				</style>
			{% else %}
				<div style="color:#888;font-size:1em; text-align:center;">No recent updates.</div>
			{% endif %}
		</div>
	</div>

	<div class="list">
		<div class="files-header">
			<h2>Request Overview</h2>
			<div style="display: flex; gap: 0.7rem;">
				<a class="add-request-btn">Submit Request</a>
			</div>
		</div>

		<!-- Search Bar -->
		<div class="search-container">
			<form class="search-bar" method="get" action="">
				<svg width="20" height="20"> <use href="#icon-search"></use> </svg>
				<input type="text" name="search" placeholder="Search" value="{{ search|default:'' }}"/>
				<button type="button" id="filterBtn" style="background:none;border:none;padding:0;margin-right:5px;cursor:pointer;">
					<svg width="20" height="20"> <use href="#icon-filter"></use> </svg>
				</button>
				
				<div id="filterDropdown" class="filter-dropdown">
					<div class="filter-grid">

						
						<!-- Sort By -->
						<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
							Sort By
							<select name="sort_by" style="width:100%;margin-top:6px;">
								<option value="updated_at" {% if sort_by == 'updated_at' %}selected{% endif %}>Last Updated</option>
								<option value="submitted_at" {% if sort_by == 'submitted_at' %}selected{% endif %}>Date Submitted</option>
								<option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title</option>
								<option value="status" {% if sort_by == 'status' %}selected{% endif %}>Status</option>
							</select>
						</label>

						<!-- Order -->
						<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
							Order
							<select name="order" style="width:100%;margin-top:6px;">
								<option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
								<option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
							</select>
						</label>

						<!-- Status Filter -->
						<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
							Status
							<select name="status" style="width:100%;margin-top:6px;">
								<option value="">All Status</option>
								<option value="RECEIVED" {% if status == 'RECEIVED' %}selected{% endif %}>Received</option>
								<option value="UNDER_REVIEW" {% if status == 'UNDER_REVIEW' %}selected{% endif %}>Under Review</option>
								<option value="APPROVED" {% if status == 'APPROVED' %}selected{% endif %}>Approved</option>
								<option value="REJECTED" {% if status == 'REJECTED' %}selected{% endif %}>Rejected</option>
								<option value="ENDORSED" {% if status == 'ENDORSED' %}selected{% endif %}>Endorsed</option>
								<option value="DENIED" {% if status == 'DENIED' %}selected{% endif %}>Denied</option>
							</select>
						</label>

						<!-- Bottom Right - Date -->
						<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
							Date
							<input type="date" name="date" value="{{ date|default:'' }}" style="width:100%;margin-top:6px;" />
						</label>
					</div>

					<!-- Buttons Row -->
					<div style="display:flex;justify-content:flex-end;gap:10px;margin-top:24px;">
					<button type="submit" class="filter-apply">Apply</button>
					<button type="button" id="closeFilter" class="filter-close">Close</button>
					</div>
				</div>
			</form>
		</div>
		
		<table class="table">
			<thead>
				<tr>
					<th>Title</th>
					<th>Date Submitted</th>
					<th>Last Updated</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
				{% for req in requests %}
				<tr>
					<td><a href="{% url 'request_details_dispatcher' req.pk %}" style="color:#063A1C;font-weight:600;text-decoration:underline;" title="{{ req.title }}">{{ req.title|truncatechars:15 }}</a></td>
					<td>{{ req.submitted_at|date:'Y-m-d H:i' }}</td>
					<td>{{ req.updated_at|date:'Y-m-d H:i' }}</td>
					<td>{{ req.get_status_display }}</td>
				</tr>
				{% empty %}
				<tr><td colspan="4" style="text-align:center;color:gray;padding:2rem;">No requests found.</td></tr>
				{% endfor %}
			</tbody>
		</table>

		<!-- Pagination -->
		<div class="pagination-container">
			{% if page_obj.has_previous %}
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">First</a>
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
			{% else %}
				<button class="pagination-button" disabled>First</button>
				<button class="pagination-button" disabled>Previous</button>
			{% endif %}

			{% for num in page_range %}
				{% if num == page_obj.number %}
					<button class="pagination-button active" disabled>{{ num }}</button>
				{% else %}
					<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
				{% endif %}
			{% endfor %}

			{% if page_obj.has_next %}
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ paginator.num_pages }}">Last</a>
			{% else %}
				<button class="pagination-button" disabled>Next</button>
				<button class="pagination-button" disabled>Last</button>
			{% endif %}

			<span class="page-info">Page {{ page_obj.number }} of {{ paginator.num_pages }}</span>
		</div>
	</div>
</main>


<!-- SVG Icons -->
<svg>

	<!-- Search -->
	<symbol id="icon-search" viewBox="0 0 21 21" fill="none">
		<path d="M8.89152 15.9057C9.75056 15.9057 10.6012 15.7365 11.3948 15.4077C12.1885 15.079 12.9096 14.5972 13.5171 13.9897C14.1245 13.3823 14.6064 12.6612 14.9351 11.8675C15.2638 11.0739 15.433 10.2232 15.433 9.36417C15.433 8.50513 15.2638 7.6545 14.9351 6.86084C14.6064 6.06719 14.1245 5.34606 13.5171 4.73862C12.9096 4.13119 12.1885 3.64934 11.3948 3.3206C10.6012 2.99186 9.75056 2.82266 8.89152 2.82266C7.1566 2.82266 5.49274 3.51185 4.26597 4.73862C3.03919 5.9654 2.35 7.62926 2.35 9.36417C2.35 11.0991 3.03919 12.763 4.26597 13.9897C5.49274 15.2165 7.1566 15.9057 8.89152 15.9057V15.9057ZM15.7819 14.713L19.685 18.6161C19.7891 18.7167 19.872 18.8371 19.9291 18.9701C19.9861 19.1032 20.0161 19.2463 20.0173 19.391C20.0184 19.5358 19.9907 19.6793 19.9358 19.8133C19.8809 19.9472 19.7999 20.0689 19.6974 20.1712C19.595 20.2735 19.4732 20.3544 19.3392 20.4091C19.2052 20.4638 19.0616 20.4913 18.9168 20.4899C18.772 20.4886 18.629 20.4584 18.496 20.4012C18.3631 20.3439 18.2428 20.2608 18.1423 20.1566L14.2392 16.2535C12.4866 17.614 10.2814 18.2554 8.07247 18.0472C5.86357 17.839 3.81705 16.7968 2.34951 15.1328C0.881971 13.4688 0.103735 11.308 0.173229 9.09044C0.242723 6.87284 1.15472 4.76508 2.72357 3.19623C4.29242 1.62738 6.40018 0.715379 8.61778 0.645885C10.8354 0.576391 12.9961 1.35463 14.6601 2.82217C16.3241 4.28971 17.3663 6.33623 17.5745 8.54513C17.7827 10.754 17.1413 12.9592 15.7808 14.7119L15.7819 14.713Z" fill="#5A5252"/>
	</symbol>

	<!-- Filter -->
	<symbol id="icon-filter" viewBox="0 0 23 22" fill="none">
		<path opacity="0.9" d="M21.5399 1.92871H1.37988L9.44388 11.4644V18.0567L13.4759 20.0727V11.4644L21.5399 1.92871Z" stroke="#1E1E1E" stroke-width="2.016" stroke-linecap="round" stroke-linejoin="round"/>
	</symbol>

</svg>

<!-- Submit Request Modal Styles -->
<style>
    .event-modal {
        position: fixed;
        z-index: 9999;
        left: 0; top: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.25);
        display: none; align-items: center; justify-content: center;
    }

    .event-modal-content {
        background: #fff;
        border-radius: 12px;
        padding: 2rem 2rem 2rem 2rem;
        min-width: 400px;
        max-width: 95vw;
        max-height: 40px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        position: relative;
        overflow-y: auto;
    }

    .event-modal-content h2 { margin-top:0; font-size:1.5rem; color:#000; font-weight: 400; }
    .event-modal-content .close {
        position: absolute; right: 1.5rem; top: 1.25rem;
        font-size: 1.5rem; color: #888; cursor: pointer;
    }

    .form-group {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 15px;
    }
    .form-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.95rem;
    }

    .submit-btn {
        background-color: #0A6C44;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
    }

    .back-btn {
        background-color: #E5E7EB;
        color: #374151;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
    }

	.required { color: #DC2626; }
    .form-actions { display: flex; gap: 1rem; margin-top: 40px; }
	.submit-btn:hover { background-color: #07532F; }
    .back-btn:hover { background-color: #D1D5DB; }
    textarea { resize: none; }

    input[type="text"], input[type="date"], input[type="time"], textarea, select {
        flex: 1;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        padding: 0.75rem;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
    }
</style>

<!-- Submit Request Modal -->
<div id="submit-request-modal" class="event-modal" style="display:none;align-items:center;justify-content:center;">
    <div class="event-modal-content" style="min-width:400px;max-width:95vw;max-height:535px;height:535px;overflow-y:auto;">
        <span class="close" id="close-submit-request-modal">&times;</span>
        <h2 id="submit-request-modal-title" style="margin-bottom:1rem;">Submit Request</h2>
        <form id="submit-request-form" method="post" enctype="multipart/form-data" action="/requests/submit/">
            {% csrf_token %}
            <div class="form-group">
                <label class="form-label">Project Title <span class="required">*</span></label>
                <input type="text" name="title" id="request_title" required style="flex:1;">
            </div>
            <div class="form-group">
                <label class="form-label">Name of Your Organization <span class="required">*</span></label>
                <input type="text" name="organization" id="request_organization" required style="flex:1;">
            </div>
            <div class="form-group">
                <label class="form-label">Primary Location <span class="required">*</span></label>
                <input type="text" name="primary_location" id="request_primary_location" required style="flex:1;">
            </div>
            <div class="form-group">
                <label class="form-label">Primary Beneficiaries <span class="required">*</span></label>
                <input type="text" name="primary_beneficiary" id="request_primary_beneficiary" required style="flex:1;">
            </div>
            <div class="form-group">
                <label class="form-label">Brief Summary <span class="required">*</span></label>
                <textarea name="summary" id="request_summary" rows="2" required style="flex:1;border-radius:8px;border:1px solid #e5e7eb;padding:0.75rem;font-size:1rem;"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Letter of Intent <span class="required">*</span></label>
                <input type="file" name="letter_of_intent" id="request_letter_of_intent" required style="flex:1;">
            </div>
            <div class="form-actions" style="justify-content:flex-end;">
                <button type="button" class="back-btn" id="cancel-submit-request-modal">Cancel</button>
                <button type="submit" class="submit-btn">Submit Request</button>
            </div>
        </form>
    </div>
</div>


<script>
	// Modal open/close logic for Submit Request
	const submitRequestModal = document.getElementById('submit-request-modal');
	const openSubmitRequestBtn = document.querySelector('.add-request-btn');
	const closeSubmitRequestModal = document.getElementById('close-submit-request-modal');
	const cancelSubmitRequestModal = document.getElementById('cancel-submit-request-modal');

	if (openSubmitRequestBtn) {
	    openSubmitRequestBtn.addEventListener('click', function() {
	        submitRequestModal.style.display = 'flex';
	    });
	}
	if (closeSubmitRequestModal) {
	    closeSubmitRequestModal.onclick = function() {
	        submitRequestModal.style.display = 'none';
	    };
	}
	if (cancelSubmitRequestModal) {
	    cancelSubmitRequestModal.onclick = function() {
	        submitRequestModal.style.display = 'none';
	    };
	}
	if (submitRequestModal) {
	    submitRequestModal.onclick = function(e) {
	        if (e.target === submitRequestModal) submitRequestModal.style.display = 'none';
	    };
	}


	// Filter dropdown logic
	const filterBtn = document.getElementById('filterBtn');
	const filterDropdown = document.getElementById('filterDropdown');
	const closeFilter = document.getElementById('closeFilter');
	if (filterBtn && filterDropdown) {
		filterBtn.addEventListener('click', function(e) {
			e.preventDefault();
			filterDropdown.style.display = 'block';
		});
	}
	if (closeFilter && filterDropdown) {
		closeFilter.addEventListener('click', function(e) {
			e.preventDefault();
			filterDropdown.style.display = 'none';
		});
	}
	// Hide dropdown when clicking outside
	document.addEventListener('mousedown', function(e) {
		if (filterDropdown && !filterDropdown.contains(e.target) && e.target !== filterBtn) {
			filterDropdown.style.display = 'none';
		}
	});
</script>

</body>
</html>

{% endblock %}