{% extends "projects/base_project_profile.html" %}
{% block profile_content %}
{% load static %} 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/projects/view.css' %}" rel="stylesheet">

<div class="card-header">
    <h3>Expenses</h3>
</div>
<div class="card-body">
    <div class="card mb-4">
        <div class="card-header">
            Add New Expense
        </div>
        <div class="card-body">
            <form method="post" action="{% url 'projects:project_addexpenses' project.id %}" enctype="multipart/form-data">
                {% csrf_token %}
                {{ faculty_expense_form|crispy }} {# Use crispy or render manually #}
                <button type="submit" class="btn btn-success mt-3">Submit Expense</button> {# Style button #}
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            Submitted Expenses
        </div>
        <div class="card-body">
            {% if expenses_page and expenses_page.object_list %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover"> {# Your table styling #}
                        <thead>
                            <tr>
                                <th>Reason</th>
                                <th>Amount</th>
                                <th>Notes</th>
                                <th>Submitted By</th>
                                <th>Date</th>
                                <th>Receipt</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses_page %}
                                <tr>
                                    <td>{{ expense.reason }}</td>
                                    <td>â‚± {{ expense.amount|floatformat:2 }}</td>
                                    <td>{{ expense.notes|default:"-"|linebreaksbr }}</td>
                                    <td>{{ expense.submitted_by.get_full_name|default:expense.submitted_by.username }}</td>
                                    <td>{{ expense.date_submitted|date:"M d, Y H:i" }}</td>
                                    <td>
                                        {% if expense.receipt %}
                                            <a href="{{ expense.receipt.url }}" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {# --- Pagination --- #}
                {% if expenses_page.has_other_pages %}
                <nav aria-label="Expense Pagination">
                    <ul class="pagination justify-content-center">
                        {% if expenses_page.has_previous %}
                            <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
                            <li class="page-item"><a class="page-link" href="?page={{ expenses_page.previous_page_number }}">Previous</a></li>
                        {% else %}
                             <li class="page-item disabled"><span class="page-link">&laquo; First</span></li>
                             <li class="page-item disabled"><span class="page-link">Previous</span></li>
                        {% endif %}

                        <li class="page-item disabled"><span class="page-link">Page {{ expenses_page.number }} of {{ expenses_page.paginator.num_pages }}.</span></li>

                        {% if expenses_page.has_next %}
                            <li class="page-item"><a class="page-link" href="?page={{ expenses_page.next_page_number }}">Next</a></li>
                            <li class="page-item"><a class="page-link" href="?page={{ expenses_page.paginator.num_pages }}">Last &raquo;</a></li>
                        {% else %}
                            <li class="page-item disabled"><span class="page-link">Next</span></li>
                            <li class="page-item disabled"><span class="page-link">Last &raquo;</span></li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            {% else %}
                <p class="text-center">No faculty expenses have been submitted for this project yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
