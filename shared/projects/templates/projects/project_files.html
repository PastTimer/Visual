{% extends "projects/base_project_profile.html" %}
{% block profile_content %}

<style>
    .name-link {
        color: #0A6C44;
        text-decoration: none;
    }

    .name-link:hover {
        color: #095c2d;
        text-decoration: underline;
    }
    
    .file-list {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 2rem;
    }

    .file-card {
        background: #fff;
        border-radius: 0.75rem;
        padding: 1rem;
        box-shadow: 0 0 0 1px #e5e7eb;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center
    }

    .file-card img {
        max-width: 100%;
        max-height: 8rem;
        border-radius: 0.5rem;
        border: 1px solid #ccc;
        object-fit: cover;
    }

    .file-card h4 {
        margin-top: 0.3rem;
        font-weight: 500;
        font-size: 1.1rem;
        text-align: center;
        word-break: break-all;
        margin-bottom: auto;
    }

    .file-card p {
        margin-top: 0.5rem;
        font-size: 0.95rem;
        color: #666;
        text-align: center;
    }
</style>


<!-- Pagination Styles -->
<style>
	.pagination-container {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 0.5rem;
	}

	.pagination-button {
		padding: 0.75rem 1rem;
		border: 1px solid #E5E7EB;
		background: white;
		color: #4B5563;
		border-radius: 8px;
		cursor: pointer;
		transition: all 0.2s ease;
		font-weight: 500;
		text-decoration: none;
	}

	.pagination-button:hover {
		background: #F3F4F6;
		border-color: #0A6C44;
		color: #0A6C44;
	}

	.pagination-button.active {
		background: #0A6C44;
		color: white;
		border-color: #0A6C44;
	}

	.pagination-button:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.page-info {
		margin: 0 1rem;
		color: #4B5563;
		font-weight: 500;
	}
</style>


<div class="card-header">
    <h3>Files</h3>
</div>
<!-- Search Bar & Filter (2x2 Grid) -->
<div class="search-container">
    <form class="search-bar" method="get" action="">
        <svg width="20" height="20"> <use href="#icon-search"></use> </svg>
        <input type="text" name="search" placeholder="Search File Name" value="{{ request.GET.search|default:'' }}"/>
        <button type="button" id="filterBtn" style="background:none;border:none;padding:0;margin-right:5px;cursor:pointer;">
            <svg width="20" height="20"> <use href="#icon-filter"></use> </svg>
        </button>
        <div id="filterDropdown" class="filter-dropdown" style="top: 640px;">
            <div class="filter-grid" style="grid-template-columns: repeat(3, 1fr); grid-template-rows: auto; grid-gap: 24px;">
                <!-- Top Left - Sort By -->
                <label>Sort By
                    <select name="sort_by">
                        <option value="name" {% if request.GET.sort_by == 'name' %}selected{% endif %}>File Name</option>
                        <option value="file_type" {% if request.GET.sort_by == 'file_type' %}selected{% endif %}>File Type</option>
                        <option value="size" {% if request.GET.sort_by == 'size' %}selected{% endif %}>Size</option>
                        <option value="date" {% if request.GET.sort_by == 'date' %}selected{% endif %}>Date</option>
                    </select>
                </label>
                <!-- Top Right - Order By -->
                <label>Order By
                    <select name="order">
                        <option value="asc" {% if request.GET.order == 'asc' %}selected{% endif %}>Ascending</option>
                        <option value="desc" {% if request.GET.order == 'desc' %}selected{% endif %}>Descending</option>
                    </select>
                </label>
                <!-- Bottom Left - File Type Filter -->
                <label>File Type
                    <select name="file_type">
                        <option value="">All Types</option>
                        {% for ext in file_types %}
                        <option value="{{ ext }}" {% if request.GET.file_type == ext %}selected{% endif %}>{{ ext|upper }}</option>
                        {% endfor %}
                    </select>
                </label>
            </div>
            <div class="filter-actions">
                <button type="submit" class="filter-apply">Apply</button>
                <button type="button" id="closeFilter" class="filter-close">Clear Filters</button>
            </div>
        </div>
    </form>
</div>
<div style="margin-top:2rem;">
    <div class="file-list">
        {% for file in files %}
        <div class="file-card">
            <a href="{{ file.file.url }}" target="_blank">
                {% if file.extension in 'jpg jpeg png gif bmp webp' %}
                    <img src="{{ file.file.url }}" alt="Image Preview">
                {% elif file.extension == 'pdf' %}
                    <div style="width:100%;height:8rem;display:flex;align-items:center;justify-content:center;">
                       <i class="fa-regular fa-file-pdf" style="font-size:3rem;color:#d32f2f;"></i>
                    </div>
                {% else %}
                    <div style="width:100%;height:8rem;display:flex;align-items:center;justify-content:center;">
                        <i class="fa-regular fa-file" style="font-size:3rem;color:#aaa;"></i>
                    </div>
                {% endif %}
            </a>
            <h4><a href="{{ file.file.url }}" class="name-link" target="_blank">{{ file.name }}</a></h4>
            <p>{{ file.extension|upper }} &bull; {{ file.size }} &bull; {{ file.uploaded_at|date:'M d, Y' }}</p>
        </div>
        {% empty %}
        <div style="grid-column:1/-1;text-align:center;color:#888;font-size:1.1rem;">No files found.</div>
        {% endfor %}
    </div>
</div>

<!-- Pagination -->
<div class="pagination-container">
    {% if page_obj.has_previous %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">First</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
    {% else %}
        <button class="pagination-button" disabled>First</button>
        <button class="pagination-button" disabled>Previous</button>
    {% endif %}

    {% for num in page_range %}
        {% if num == page_obj.number %}
            <button class="pagination-button active" disabled>{{ num }}</button>
        {% else %}
            <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ paginator.num_pages }}">Last</a>
    {% else %}
        <button class="pagination-button" disabled>Next</button>
        <button class="pagination-button" disabled>Last</button>
    {% endif %}

    <span class="page-info">Page {{ page_obj.number }} of {{ paginator.num_pages }}</span>
</div>

{% endblock %}
