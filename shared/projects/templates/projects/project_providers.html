{% extends "projects/base_project_profile.html" %}
{% block profile_content %}
<style>
    .providers {
        display: flex;
        flex-wrap: wrap; 
        justify-content: center; 
        gap: 1rem; 
    }

    .providers > * {
        box-sizing: border-box;
    }

    .tiles {
        border: 0.08rem solid #a9a9a9;
        border-radius: 15px;
        width: 18rem;
        height: 22.5rem;
        padding: 1rem;
    }

    .providers > div h5 {
        margin: 0;
        font-weight: 600;
    }
    
    .providers > div h3 {
        font-weight: 500;
        margin: 0.25rem 0;
    }

    .prov-seg-sec {
        display: flex;
        justify-content: space-between;
    }

    .prov-seg-sec img {
        width: 5rem;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: -3rem;
    }

    .prof {
        width: 10rem;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        margin: 1rem 1rem 1rem 1rem;
    }

    .blank {
        opacity: 0;
    }
</style>

<!-- Pagination Styles -->
<style>
	.pagination-container {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 0.5rem;
	}

	.pagination-button {
		padding: 0.75rem 1rem;
		border: 1px solid #E5E7EB;
		background: white;
		color: #4B5563;
		border-radius: 8px;
		cursor: pointer;
		transition: all 0.2s ease;
		font-weight: 500;
		text-decoration: none;
	}

	.pagination-button:hover {
		background: #F3F4F6;
		border-color: #0A6C44;
		color: #0A6C44;
	}

	.pagination-button.active {
		background: #0A6C44;
		color: white;
		border-color: #0A6C44;
	}

	.pagination-button:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.page-info {
		margin: 0 1rem;
		color: #4B5563;
		font-weight: 500;
	}
</style>

<div class="card-header">
    <h3>Providers</h3>
    {% if request.user.role in ADMIN_ROLES %}
    <button class="admin-button" id="show-provider-dropdown">Add Provider</button>
    <div id="provider-dropdown" style="display:none; position:absolute; z-index:2; margin-top:5px; margin-left:-30px; min-width:220px; background:#fff; border:1px solid #ccc; border-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,0.1); max-height:220px; overflow-y:auto;">
        <ul style="list-style:none; margin:0; padding:0;">
            {% for provider in provider_candidates %}
                <li class="provider-option" data-id="{{ provider.id }}" style="padding:8px 12px; cursor:pointer; border-bottom:1px solid #eee;">
                    {{ provider.get_full_name }}
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
            const btn = document.getElementById('show-provider-dropdown');
            const dropdown = document.getElementById('provider-dropdown');
            btn.addEventListener('click', function(e) {
                const rect = btn.getBoundingClientRect();
                dropdown.style.left = rect.left + 'px';
                dropdown.style.top = (rect.bottom + 10 + window.scrollY) + 'px';
                dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            });

            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && e.target !== btn) {
                    dropdown.style.display = 'none';
                }
            });

            dropdown.querySelectorAll('.provider-option').forEach(function(item) {
                item.addEventListener('click', function() {
                    const providerId = item.getAttribute('data-id');
                    // Create and submit a form dynamically
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '';
                    const csrf = document.createElement('input');
                    csrf.type = 'hidden';
                    csrf.name = 'csrfmiddlewaretoken';
                    csrf.value = '{{ csrf_token }}';
                    form.appendChild(csrf);
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'provider_id';
                    input.value = providerId;
                    form.appendChild(input);
                    document.body.appendChild(form);
                    form.submit();
                });
            });
    </script>
    {% endif %}
</div>
<div class="providers">
    {% for provider in page_obj %}
    <div class="tiles">
        <section class="prov-seg-sec">
            {% if provider.role == 'IMPLEMENTER' %}
                <button class="campus blank">&nbsp;</button>
                <img src="/media/colleges/logos/Default.png" alt="college logo" class="blank">
            {% else %}
                <button class="campus">{{ provider.get_campus_display }}</button>
                {% if provider.college and provider.college.logo %}
                    <img src="{{ provider.college.logo.url }}" alt="college logo" style="width: 3.5rem; height: 100%;">
                {% else %}
                    <img src="/media/colleges/logos/Default.png" alt="college logo" style="width: 3.5rem; height: 100%;">
                {% endif %}
            {% endif %}
        </section>
        <section style="text-align: center;">
            <img src="{{ provider.profile_picture_or_initial }}" alt="profile" class="prof">
        </section>
        <section style="text-align: center;">
            <h3>{{ provider.get_full_name|default:provider.username }}</h3>
            <h5>{{ provider.degree }}</h5>
        </section>
    </div>
    {% empty %}
    <p>No providers found.</p>
    {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination-container">
    {% if page_obj.has_previous %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">First</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
    {% else %}
        <button class="pagination-button" disabled>First</button>
        <button class="pagination-button" disabled>Previous</button>
    {% endif %}

    {% for num in page_range %}
        {% if num == page_obj.number %}
            <button class="pagination-button active" disabled>{{ num }}</button>
        {% else %}
            <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ paginator.num_pages }}">Last</a>
    {% else %}
        <button class="pagination-button" disabled>Next</button>
        <button class="pagination-button" disabled>Last</button>
    {% endif %}

    <span class="page-info">Page {{ page_obj.number }} of {{ paginator.num_pages }}</span>
</div>

{% endblock %}
