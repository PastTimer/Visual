{% extends "projects/base_project_profile.html" %}
{% block profile_content %}
{% load static %} 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/projects/view.css' %}" rel="stylesheet">


<style>
    .clickable-tile {
        cursor: pointer; 
        transition: transform 0.3s ease-in-out; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .clickable-tile:hover {
        transform: scale(1.05); 
        z-index: 10;
    }
</style>


<div class="card-header">
    <h3>Providers</h3>
    {% if request.user.role in ADMIN_ROLES and not project.has_final_submission %}
    <button class="admin-button save" id="show-provider-dropdown">Add Provider</button>
    <div id="provider-dropdown" style="display:none; position:absolute; z-index:2; margin-top:5px; margin-left:-30px; min-width:220px; background:#fff; border:1px solid #ccc; border-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,0.1); max-height:220px; overflow-y:auto;">
        <ul style="list-style:none; margin:0; padding:0;">
            {% for provider in provider_candidates %}
                <li class="provider-option" data-id="{{ provider.id }}" style="padding:8px 12px; cursor:pointer; border-bottom:1px solid #eee;">
                    {{ provider.get_full_name }}
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
            const btn = document.getElementById('show-provider-dropdown');
            const dropdown = document.getElementById('provider-dropdown');
            btn.addEventListener('click', function(e) {
                const rect = btn.getBoundingClientRect();
                dropdown.style.left = rect.left + 'px';
                dropdown.style.top = (rect.bottom + 10 + window.scrollY) + 'px';
                dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            });

            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && e.target !== btn) {
                    dropdown.style.display = 'none';
                }
            });

            dropdown.querySelectorAll('.provider-option').forEach(function(item) {
                item.addEventListener('click', function() {
                    const providerId = item.getAttribute('data-id');
                    // Create and submit a form dynamically
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '';
                    const csrf = document.createElement('input');
                    csrf.type = 'hidden';
                    csrf.name = 'csrfmiddlewaretoken';
                    csrf.value = '{{ csrf_token }}';
                    form.appendChild(csrf);
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'provider_id';
                    input.value = providerId;
                    form.appendChild(input);
                    document.body.appendChild(form);
                    form.submit();
                });
            });
    </script>
    {% endif %}
</div>
<div class="providers">
    {% for provider in page_obj %}
    <div class="tiles clickable-tile" onclick="window.location.href='{% url 'user_profile' provider.id %}'">
        <section class="prov-seg-sec">
            {% if provider.role == 'IMPLEMENTER' %}
                <button class="campus blank">&nbsp;</button>
                <img src="/media/colleges/logos/Default.png" alt="college logo" class="blank">
            {% else %}
                <button class="campus">{{ provider.get_campus_display }}</button>
                {% if provider.college and provider.college.logo %}
                    <img src="{{ provider.college.logo.url }}" alt="college logo">
                {% else %}
                    <img src="/media/colleges/logos/Default.png" alt="college logo">
                {% endif %}
            {% endif %}
        </section>
        <section style="text-align: center;">
            <img src="{{ provider.profile_picture_or_initial }}" alt="profile" class="prof">
        </section>
        <section style="text-align: center;">
            <h3>{{ provider.get_full_name|default:provider.username }}</h3>
            <h5>{{ provider.degree }}</h5>
        </section>    
    </div>
    {% empty %}
    <p>No providers found.</p>
    {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination-container">
    {% if page_obj.has_previous %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">First</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
    {% else %}
        <button class="pagination-button" disabled>First</button>
        <button class="pagination-button" disabled>Previous</button>
    {% endif %}

    {% for num in page_range %}
        {% if num == page_obj.number %}
            <button class="pagination-button active" disabled>{{ num }}</button>
        {% else %}
            <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ paginator.num_pages }}">Last</a>
    {% else %}
        <button class="pagination-button" disabled>Next</button>
        <button class="pagination-button" disabled>Last</button>
    {% endif %}
</div>

{% endblock %}
