{% extends base_template %}
{% block content %}
<title>Submission Details</title>

<style>
    body {
        background: #F9F9F9;
        margin: 0;
        font-family: 'Inter', sans-serif;
    }

    .main-container {
        margin: 60px;
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    .detail-text {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 32px;
        color: #000000;
    }

    .detail-container {
        border-radius: 20px;
        background: #FEFCFC;
        box-shadow: 0 0 8px 1px rgba(0, 0, 0, 0.25);
        padding: 50px 60px;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .detail-trio {
        display: flex;
        align-items: flex-start;
    }

    .detail-trio > :nth-child(1) {
        margin-right: 10px;
    }

    .detail-trio > :nth-child(2) {
        margin-right: 75px;
    }

    .detail-icon {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .detail-item {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 20px;
        width: 210px;
    }

    .detail-value {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 20px;
    }


    .back-btn, .action-btn, .reject-btn {
        display: inline-block;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-size: 1rem;
        font-weight: 500;
        border: none;
        text-align: center;
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .back-btn { background: #6B7280; }
    .back-btn:hover { background: #4b5563; }
    .action-btn { background: #063A1C; }
    .action-btn:hover { background: #095c2d; }
    .reject-btn { background: #D5110A; }
    .reject-btn:hover { background: #a10c07; }

    /* Modal Styles */
    .modal-bg {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.25);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .modal {
        background: #fff;
        border-radius: 1rem;
        box-shadow: 0 2px 16px rgba(0,0,0,0.18);
        padding: 2.5rem 2.5rem 2rem 2.5rem;
        min-width: 350px;
        max-width: 95vw;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        align-items: center;
    }

    .modal-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #222;
    }
    .modal-content {
        font-size: 1rem;
        color: #444;
        margin-bottom: 1rem;
        text-align: center;
    }
    .modal-actions {
        display: flex;
        gap: 20px;
        justify-content: center;
        width: 100%;
    }
    .modal input, .modal textarea {
        width: 100%;
        padding: 0.5rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
        margin-bottom: 1rem;
    }

    textarea {
        resize: none;
    }

    /* Submission Modal Styles */
    .submission-modal {
        position: fixed;
        z-index: 1000;
        left: 0; top: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.3);
        display: flex; align-items: center; justify-content: center;
    }

    .submission-modal .modal-content {
        background: #fff;
        border-radius: 1rem;
        padding: 2.5rem 2.5rem 2rem 2.5rem;
        min-width: 340px;
        max-width: 95vw;
        box-shadow: 0 4px 32px 0 rgba(0,0,0,0.18);
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .close-modal {
        position: absolute;
        top: 1.2rem;
        right: 1.7rem;
        font-size: 1.7rem;
        color: #888;
        cursor: pointer;
        transition: color 0.2s;
    }
    .close-modal:hover {
        color: #222;
    }

    .form-group {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 0.5rem;
    }

    .form-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.95rem;
    }

    .required {
        color: #DC2626;
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .submit-btn {
        background-color: #0A6C44;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
    }

    .submit-btn:hover {
        background-color: #07532F;
    }

    .submission-modal h2 {
        margin-top: 0;
        font-size: 1.5rem;
        color: #000;
        font-weight: 400;
    }

    input[type="text"], input[type="date"], textarea, input[type="file"], input[type="datetime-local"], input[type="number"] {
        flex: 1;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        padding: 0.75rem;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
    }

    select {
        flex: 1;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        padding: 0.75rem;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding-right: 2rem;
        background: url("data:image/svg+xml;utf8,<svg width='16' height='11' viewBox='0 0 16 11' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M7.99976 7.19417L13.9025 1.29147C14.0125 1.17758 14.144 1.08674 14.2895 1.02424C14.435 0.961746 14.5915 0.92885 14.7498 0.927474C14.9082 0.926098 15.0652 0.95627 15.2117 1.01623C15.3583 1.07619 15.4914 1.16473 15.6034 1.27669C15.7153 1.38866 15.8039 1.5218 15.8638 1.66835C15.9238 1.8149 15.954 1.97192 15.9526 2.13026C15.9512 2.28859 15.9183 2.44506 15.8558 2.59055C15.7933 2.73604 15.7025 2.86762 15.5886 2.97762L8.84283 9.72339C8.61921 9.94694 8.31596 10.0725 7.99976 10.0725C7.68356 10.0725 7.38031 9.94694 7.15669 9.72339L0.41092 2.97762C0.297028 2.86762 0.206183 2.73604 0.143687 2.59055C0.0811915 2.44506 0.0482959 2.28859 0.04692 2.13026C0.0455441 1.97192 0.0757155 1.8149 0.135674 1.66835C0.195632 1.5218 0.284176 1.38866 0.39614 1.27669C0.508103 1.16473 0.641244 1.07619 0.787794 1.01623C0.934343 0.95627 1.09137 0.926098 1.2497 0.927474C1.40804 0.92885 1.56451 0.961746 1.71 1.02424C1.85548 1.08674 1.98706 1.17758 2.09706 1.29147L7.99976 7.19417Z' fill='%23374151'/></svg>")
                no-repeat right 0.75rem center;
        background-size: 13px 8px;
    }

</style>

<style>
    .name-link {
        color: #0A6C44;
        text-decoration: none;
    }

    .name-link:hover {
        color: #095c2d;
        text-decoration: underline;
    }

    .upper {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    .upper-left {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 5px;
    }

    .upper-right {
        display: flex;
        flex-direction: column;
        gap: 5px;
        align-items: flex-end;
    }

    .file-text {
        font-size: 2.3em;
        font-weight: 600;
    }

    .green-text {
        color: #0A6C44;
    }

    .grey-text {
        font-size: 0.9em;
        font-weight: 400;
        color: #6c757d;
    }
    
    .deadline-text {
        font-size: 1.1em;
        font-weight: 600;
        color: #181818;
    }

    hr {
        border: none;
        border-top: 1px solid #7b7b7b;
        margin: 0.5rem 1rem;
    }

    .notes-text {
        font-size: 1.1em;
        font-weight: 400;
        color: #181818;
        word-break: break-word;
    }

    .trained-individuals-text {
        font-size: 1.5em;
        font-weight: 600;
        color: #181818;
    }

    input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-top: 4px;
        accent-color: black;
    }

    .content-leftright {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        gap: 150px;
    }

    .content-left {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    .content-right {
        display: flex;
        flex-direction: column;
        gap: 30px;
        min-width: 40%;
        max-width: 40%;
    }

    .final-text {
        font-size: 1.2em;
        font-weight: 500;
    }

    .event-image {
        width: 300px;
        height: auto;
        border-radius: 8px;
        object-fit: cover;
    }

    .red {
        color: #D5110A;
    }

    .redirect-text {
        color: #007bff;
        text-decoration: none;
    }

    .redirect-container {
        display: flex;
        gap: 20px;
    }
    
    .redirect-text:hover {
        text-decoration: underline;
        cursor: pointer;
    }

    .action-container {
        margin-top: 0.5rem;
    }

    .action-form {
        display: flex;
        gap: 15px;
        justify-content: center;
    }
    
    .final-adjust {
        margin-left: 0.5rem;
    }
</style>

<div class="main-container">

    <div class="redirect-container">
        <a href="{% url 'project_submissions' project.id %}" class="redirect-text">Go to Project Details ðŸ¡•</a>
        {% if request.user.role in ADMIN_ROLES or request.user.role in COORDINATOR_ROLE %}
        <a href="{% url 'submissions_admin' %}" class="redirect-text">Go to Submissions ðŸ¡•</a>
        {% endif %}
    </div>

    <div class="upper">
        <div class="upper-left">
            {% if submission.downloadable.file.url %}
            <a href="{{ submission.downloadable.file.url }}" target="_blank" class="name-link file-text">{{ submission.downloadable.name }}</a>
            {% endif %}
            
            <span class="green-text">
                <a class="name-link" href="{% url 'project_submissions' submission.project.id %}">{{ submission.project.title }}</a>
                {% if submission.downloadable.submission_type == "event" %} â€¢ {{ submission.event.title }}{% endif %}
            </span>

            <span class="grey-text">Assigned: {{ submission.created_at|date:"F j, Y, H:i" }}{% if request.user.role in ADMIN_ROLES%} â€¢ <a href="{% url 'user_profile' submission.created_by.id %}" class="name-link">{{ submission.created_by.get_full_name }}</a>{% endif %}</span>
         
            {% if submission.submitted_by %}
            <span class="grey-text">Submitted:  {{ submission.submitted_at|date:"F j, Y, H:i" }} â€¢ <a href="{% url 'user_profile' submission.submitted_by.id %}" class="name-link">{{ submission.submitted_by.get_full_name }}</a></span>
            {% endif %}
            {% if submission.reviewed_by %}
            <span class="grey-text">Reviewed:  {{ submission.reviewed_at|date:"F j, Y, H:i" }}{% if request.user.role in ADMIN_ROLES or request.user.role in COORDINATOR_ROLE %} â€¢ <a href="{% url 'user_profile' submission.reviewed_by.id %}" class="name-link">{{ submission.reviewed_by.get_full_name }}</a>{% endif %}</span>
            {% endif %}
            {% if submission.authorized_by %}
            <span class="grey-text">Authorized: {{ submission.authorized_at|date:"F j, Y, H:i" }}{% if request.user.role in ADMIN_ROLES%} â€¢ <a href="{% url 'user_profile' submission.authorized_by.id %}" class="name-link">{{ submission.authorized_by.get_full_name }}</a>{% endif %}</span>
            {% endif %}
        </div>

        <div class="upper-right">
            <span class="deadline-text">Due on {{ submission.deadline|date:"F j, Y, H:i" }}</span>
            <span class="grey-text">Status: {{ submission.get_status_display }}</span>
        </div>
    </div>

    <hr>

    <div class="content-leftright">
        <div class="content-left">
            {% if submission.notes %} <span class="notes-text">{{ submission.notes }}</span> {% endif %}
            {% if submission.status == "REVISION_REQUESTED" %} <span class="notes-text"><strong class="red">Reason/s for Requesting Revision</strong><br>{{ submission.reason_for_revision }}</span>{% endif %}
            {% if submission.status == "REJECTED" %} <span class="notes-text"><strong class="red">Reason/s for Rejection</strong><br>{{ submission.reason_for_rejection }}</span>{% endif %}
            {% if submission.file %} <span class="notes-text"><a href="{{ submission.file.url }}" target="_blank" class="name-link">File Here</a></span>{% endif %}
        </div>

        <div class="content-right">
            {% if submission.status != "PENDING" %}
                <!-- Submission [Event] Details -->
                {% if submission.downloadable.submission_type == "event" %}
                    <span class="trained-individuals-text">{{ submission.num_trained_individuals }} Trained Individuals</span>

                    {% if submission.image_event %}
                    <span class="event-image"><a href="{{ submission.image_event.url }}" target="_blank" class="name-link">Image Here</a></span>
                    {% else %}
                    <span class="event-image">No Image</span>
                    {% endif %}

                    <span class="notes-text">{{ submission.image_description }}</span>

                <!-- Submission [Final] Details -->
                {% elif submission.downloadable.submission_type == "final" %}
                    <span class="final-text">{% if submission.for_product_production %}<i class="fa-solid fa-check"></i>{% elif submission.for_product_production == False %}<i class="fa-solid fa-xmark"></i>{% else %}_{% endif %} <span class="final-adjust">For Product Production</span></span>
                    <span class="final-text">{% if submission.for_research %}<i class="fa-solid fa-check"></i>{% elif submission.for_research == False %}<i class="fa-solid fa-xmark"></i>{% else %}_{% endif %} <span class="final-adjust">For Research</span></span>
                    <span class="final-text">{% if submission.for_extension %}<i class="fa-solid fa-check"></i>{% elif submission.for_extension == False %}<i class="fa-solid fa-xmark"></i>{% else %}_{% endif %} <span class="final-adjust">For Extension</span></span>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="action-container">
        {% if submission.status == 'PENDING' and request.user.id == project.project_leader.id or request.user.id in provider_ids %}
        <div class="action-form">
            <button type="button" class="action-btn" id="submit-btn" 
                    data-submission-type="{{ submission.downloadable.submission_type }}" 
                    data-submission-id="{{ submission.id }}">Submit
            </button>
        </div>

        {% elif submission.status == 'PENDING' and request.user.role in ADMIN_ROLES %}
        <div class="action-form">
            <button type="button" class="reject-btn" id="delete-btn">Delete</button>
        </div>

        {% elif submission.status == 'SUBMITTED' and request.user.id == project.project_leader.id or request.user.id in provider_ids %}
       <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" class="action-form">
            {% csrf_token %}
            <button type="submit" name="action" value="unsubmit" class="reject-btn">Unsubmit</button>
        </form>

        {% elif submission.status == 'SUBMITTED' and request.user.role == 'COORDINATOR' %}
        <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" class="action-form">
            {% csrf_token %}
            <button type="submit" name="action" value="forward" class="action-btn">Forward to UESO</button>
            <button type="button" class="reject-btn" id="request-revision-btn">Request Revision</button>
        </form>

        {% elif submission.status == 'SUBMITTED' and project_leader_has_no_college and request.user.role in ADMIN_ROLES and user_not_in_project %}
        <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" class="action-form">
            {% csrf_token %}
            <button type="submit" name="action" value="accept" class="action-btn">Approve</button>
            <button type="button" class="reject-btn" id="request-revision-btn">Request Revision</button>
        </form>

        {% elif submission.status == 'FORWARDED' and request.user.role in ADMIN_ROLES and user_not_in_project %}
        <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" class="action-form">
            {% csrf_token %}
            <button type="submit" name="action" value="accept" class="action-btn">Accept</button>
            <button type="button" class="reject-btn" id="reject-btn">Reject</button>
        </form>

        {% elif submission.status == 'REVISION_REQUESTED' and request.user.id == project.project_leader.id or request.user.id in provider_ids %}
        <div class="action-form">
            <button type="button" class="action-btn" id="submit-revision-btn" 
                    data-submission-type="{{ submission.downloadable.submission_type }}" 
                    data-submission-id="{{ submission.id }}">Submit Revision</button>
        </div>
        {% endif %}
    </div>

    <!-- Submission Modals -->
    <!-- Submission [Final] -->
    <div id="modal-final" class="submission-modal" style="display:none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="margin-bottom:1rem;">Final Submission</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="submission_id" value="{{ submission.id }}" />
                <input type="hidden" name="action" value="submit" />
                <div class="form-group">
                    <label class="form-label">File:</label>
                    <input type="file" name="final_file" required accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
                </div>

                <div class="form-group">
                    <label><input type="checkbox" name="for_product_production"> For Product Production</label><br>
                    <label><input type="checkbox" name="for_research"> For Research</label><br>
                    <label><input type="checkbox" name="for_extension"> For Extension</label>
                </div>

                <div class="form-actions" style="justify-content:flex-end;">
                    <button type="button" class="back-btn">Cancel</button>
                    <button type="submit" class="submit-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Submission [Event] -->
    <div id="modal-event" class="submission-modal" style="display:none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="margin-bottom:1rem;">Event Submission</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="submission_id" value="{{ submission.id }}" />
                <input type="hidden" name="action" value="submit" />
                <div class="form-group">
                    <label class="form-label">No. of Trained Individuals <span class="required">*</span></label><br>
                    <input type="number" name="num_trained_individuals" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Image File <span class="required">*</span></label><br>
                    <input type="file" name="image_event" accept="image/jpeg,image/png,image/jpg,image/gif,image/webp,application/pdf" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description of Picture <span class="required">*</span></label><br>
                    <textarea name="image_description" rows="3" required></textarea>
                </div>

                <div class="form-actions" style="justify-content:flex-end;">
                    <button type="button" class="back-btn">Cancel</button>
                    <button type="submit" class="submit-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Submission [File] -->
    <div id="modal-file" class="submission-modal" style="display:none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 style="margin-bottom:1rem;">File Submission</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="submission_id" value="{{ submission.id }}" />
                <input type="hidden" name="action" value="submit" />
                <div class="form-group">
                    <label class="form-label">File <span class="required">*</span></label>
                    <input type="file" name="file_file" required accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
                </div>

                <div class="form-actions" style="justify-content:flex-end;">
                    <button type="button" class="back-btn">Cancel</button>
                    <button type="submit" class="submit-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-bg" class="modal-bg" style="display:none;">
        <div class="modal" id="modal-reject" style="display:none;">
            <div class="modal-title">Reject Submission</div>
            <div class="modal-content">Please provide a reason for rejection:</div>
            <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" style="width:100%;">
                {% csrf_token %}
                <input type="hidden" name="action" value="reject" />
                <textarea name="reason" rows="3" required placeholder="Enter reason..." style="resize:vertical;"></textarea>
                <div class="modal-actions">
                    <button type="button" class="back-btn" id="cancel-reject">Cancel</button>
                    <button type="submit" class="reject-btn">Reject</button>
                </div>
            </form>
        </div>
        <div class="modal" id="modal-request-revision" style="display:none;">
            <div class="modal-title">Request Revision</div>
            <div class="modal-content">Please provide a reason for revision:</div>
            <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" style="width:100%;">
                {% csrf_token %}
                <input type="hidden" name="action" value="request_revision" />
                <textarea name="reason" rows="3" required placeholder="Enter reason..." style="resize:vertical;"></textarea>
                <div class="modal-actions">
                    <button type="button" class="back-btn" id="cancel-request-revision">Cancel</button>
                    <button type="submit" class="reject-btn">Request Revision</button>
                </div>
            </form>
        </div>
        <div class="modal" id="modal-delete" style="display:none;">
            <div class="modal-title">Delete Submission</div>
            <div class="modal-content">Are you sure you want to delete this submission? This action cannot be undone.</div>
            <form method="post" action="{% url 'admin_submission_action' project.id submission.id %}" style="width:100%;">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete" />
                <div class="modal-actions">
                    <button type="button" class="back-btn" id="cancel-delete">Cancel</button>
                    <button type="submit" class="reject-btn">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- SVG Icons -->
<svg style="display:none;">
    <symbol id="detail-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.8008 17.5508C12.1266 17.5508 12.3999 17.4404 12.6207 17.2196C12.8415 16.9988 12.9515 16.7258 12.9508 16.4008V11.8008C12.9508 11.4749 12.8404 11.202 12.6196 10.982C12.3988 10.7619 12.1258 10.6515 11.8008 10.6508C11.4757 10.65 11.2028 10.7604 10.982 10.982C10.7612 11.2035 10.6508 11.4765 10.6508 11.8008V16.4008C10.6508 16.7266 10.7612 16.9999 10.982 17.2207C11.2028 17.4415 11.4757 17.5515 11.8008 17.5508ZM11.8008 8.35078C12.1266 8.35078 12.3999 8.24038 12.6207 8.01958C12.8415 7.79878 12.9515 7.52585 12.9508 7.20078C12.95 6.87571 12.8396 6.60278 12.6196 6.38198C12.3995 6.16118 12.1266 6.05078 11.8008 6.05078C11.4749 6.05078 11.202 6.16118 10.982 6.38198C10.7619 6.60278 10.6515 6.87571 10.6508 7.20078C10.65 7.52585 10.7604 7.79916 10.982 8.02073C11.2035 8.2423 11.4765 8.35231 11.8008 8.35078ZM11.8008 23.3008C10.2099 23.3008 8.71495 22.9987 7.31578 22.3946C5.91662 21.7904 4.69953 20.9713 3.66453 19.937C2.62953 18.9028 1.81035 17.6857 1.20698 16.2858C0.603616 14.8858 0.301549 13.3908 0.300783 11.8008C0.300016 10.2107 0.602083 8.71571 1.20698 7.31578C1.81188 5.91585 2.63107 4.69876 3.66453 3.66453C4.698 2.6303 5.91508 1.81111 7.31578 1.20698C8.71648 0.602848 10.2115 0.300781 11.8008 0.300781C13.3901 0.300781 14.8851 0.602848 16.2858 1.20698C17.6865 1.81111 18.9036 2.6303 19.937 3.66453C20.9705 4.69876 21.7901 5.91585 22.3957 7.31578C23.0014 8.71571 23.3031 10.2107 23.3008 11.8008C23.2985 13.3908 22.9964 14.8858 22.3946 16.2858C21.7927 17.6857 20.9736 18.9028 19.937 19.937C18.9005 20.9713 17.6834 21.7908 16.2858 22.3957C14.8881 23.0006 13.3931 23.3023 11.8008 23.3008ZM11.8008 21.0008C14.3691 21.0008 16.5445 20.1095 18.327 18.327C20.1095 16.5445 21.0008 14.3691 21.0008 11.8008C21.0008 9.23245 20.1095 7.05703 18.327 5.27453C16.5445 3.49203 14.3691 2.60078 11.8008 2.60078C9.23245 2.60078 7.05703 3.49203 5.27453 5.27453C3.49203 7.05703 2.60078 9.23245 2.60078 11.8008C2.60078 14.3691 3.49203 16.5445 5.27453 18.327C7.05703 20.1095 9.23245 21.0008 11.8008 21.0008Z" fill="black"/>
    </symbol>
</svg>

<script>
    // Modal logic
    function showModal(which) {
        document.getElementById('modal-bg').style.display = 'flex';
        document.getElementById('modal-reject').style.display = (which === 'reject') ? 'flex' : 'none';
        document.getElementById('modal-request-revision').style.display = (which === 'request-revision') ? 'flex' : 'none';
        document.getElementById('modal-delete').style.display = (which === 'delete') ? 'flex' : 'none';
    }

    function hideModal() {
        document.getElementById('modal-bg').style.display = 'none';
        document.getElementById('modal-reject').style.display = 'none';
        document.getElementById('modal-request-revision').style.display = 'none';
        document.getElementById('modal-delete').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Submission modal logic
        function openSubmissionModal(submissionType, submissionId) {
            var modalId = '';
            if (submissionType === 'final') {
                modalId = 'modal-final';
            } else if (submissionType === 'event') {
                modalId = 'modal-event';
            } else {
                modalId = 'modal-file';
            }
            
            var modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                var input = modal.querySelector('input[name="submission_id"]');
                if (input) input.value = submissionId;
            }
        }

        // Submit button click handlers
        var submitBtn = document.getElementById('submit-btn');
        var submitRevisionBtn = document.getElementById('submit-revision-btn');
        
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                var type = this.getAttribute('data-submission-type');
                var id = this.getAttribute('data-submission-id');
                openSubmissionModal(type, id);
            });
        }
        
        if (submitRevisionBtn) {
            submitRevisionBtn.addEventListener('click', function() {
                var type = this.getAttribute('data-submission-type');
                var id = this.getAttribute('data-submission-id');
                openSubmissionModal(type, id);
            });
        }

        // Close submission modals
        document.querySelectorAll('.close-modal').forEach(function(btn) {
            btn.addEventListener('click', function() {
                btn.closest('.submission-modal').style.display = 'none';
            });
        });
        
        // Close submission modals on Cancel button
        document.querySelectorAll('.submission-modal .back-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                btn.closest('.submission-modal').style.display = 'none';
            });
        });
        
        // Close submission modals on clicking outside modal-content
        document.querySelectorAll('.submission-modal').forEach(function(modal) {
            modal.addEventListener('mousedown', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Close submission modals on Escape key
        window.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.submission-modal').forEach(function(modal) {
                    modal.style.display = 'none';
                });
            }
        });

        // Existing modal logic for rejection/revision modals
        var rejectBtn = document.getElementById('reject-btn');
        var requestRevisionBtn = document.getElementById('request-revision-btn');
        var deleteBtn = document.getElementById('delete-btn');
        if (rejectBtn) rejectBtn.onclick = function() { showModal('reject'); };
        if (requestRevisionBtn) requestRevisionBtn.onclick = function() { showModal('request-revision'); };
        if (deleteBtn) deleteBtn.onclick = function() { showModal('delete'); };
        // Cancel buttons
        var cancelReject = document.getElementById('cancel-reject');
        var cancelRequestRevision = document.getElementById('cancel-request-revision');
        var cancelDelete = document.getElementById('cancel-delete');
        if (cancelReject) cancelReject.onclick = hideModal;
        if (cancelRequestRevision) cancelRequestRevision.onclick = hideModal;
        if (cancelDelete) cancelDelete.onclick = hideModal;
        // Hide modal when clicking outside
        var modalBg = document.getElementById('modal-bg');
        if (modalBg) {
            modalBg.addEventListener('click', function(e) {
                if (e.target === this) hideModal();
            });
        }
    });

    // Success Toast
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('success');
        const action = urlParams.get('action');
        const title = urlParams.get('title');

        if (success === 'true' && action === 'submitted') {
            const toast = document.createElement('div');
            toast.id = 'successToast';
            toast.style.cssText = 'display:block;position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:10000;font-size:1rem;font-weight:500;min-width:300px;';
            toast.innerHTML = `
                <div style="display:flex;align-items:center;gap:0.75rem;">
                    <i class="fa-solid fa-check-circle" style="font-size:1.5rem;"></i>
                    <div>
                        <div style="font-weight:600;margin-bottom:0.25rem;">Submitted Successfully!</div>
                        <div style="font-size:0.875rem;opacity:0.9;">${title ? decodeURIComponent(title) : 'Submission'}</div>
                    </div>
                </div>
            `;
            document.body.appendChild(toast);

            // Auto-hide after 4 seconds
            setTimeout(function() {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(function() {
                    toast.remove();
                    // Clean URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }, 300);
            }, 4000);
        }
    });
</script>

{% endblock %}