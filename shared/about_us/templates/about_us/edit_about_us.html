{% extends "base_internal.html" %}
{% block content %}
{% load static %}
<link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/aboutus/styles.css' %}" rel="stylesheet">

<div class="main-container">
    <div class="form-header">
        <h1 class="form-title">Edit About Us</h1>
    </div>

    {% if form.errors %}
        <div style="background:#ffeaea; color:#b91c1c; border:1px solid #fca5a5; border-radius:8px; padding:16px; margin-bottom:24px;">
            <strong>There were errors in your submission:</strong>
            <ul style="margin:8px 0 0 16px;">
                {% for field in form %}
                    {% for error in field.errors %}
                        <li>{{ field.label }}: {{ error }}</li>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="id_hero_text" class="form-label">About Us</label>
            <textarea id="id_hero_text" name="hero_text" class="form-input form-textarea" rows="3">{{ form.hero_text.value|default:'' }}</textarea>
        </div>
        <div class="form-group">
            <label for="id_vision_text" class="form-label">Vision</label>
            <textarea id="id_vision_text" name="vision_text" class="form-input form-textarea" rows="3">{{ form.vision_text.value|default:'' }}</textarea>
        </div>
        <div class="form-group">
            <label for="id_mission_text" class="form-label">Mission</label>
            <textarea id="id_mission_text" name="mission_text" class="form-input form-textarea" rows="3">{{ form.mission_text.value|default:'' }}</textarea>
        </div>
        <div class="form-group">
            <label for="id_thrust_text" class="form-label">Thrust and Priorities</label>
            <textarea id="id_thrust_text" name="thrust_text" class="form-input form-textarea" rows="3">{{ form.thrust_text.value|default:'' }}</textarea>
        </div>
        <div class="form-group">
            <label for="id_leadership_description" class="form-label">Leadership Description</label>
            <textarea id="id_leadership_description" name="leadership_description" class="form-input form-textarea" rows="3">{{ form.leadership_description.value|default:'' }}</textarea>
        </div>
        <div class="form-group">
            <label for="id_director_name" class="form-label">Director Name</label>
            <input type="text" id="id_director_name" name="director_name" value="{{ form.director_name.value|default:'' }}" class="form-input">
        </div>

        <div class="form-group">
            <label for="id_director_image" class="form-label">Director Image</label>
            <div style="flex:1;">
                {% if about.director_image %}
                    <img src="{{ about.director_image.url }}" alt="Current Director Image" style="max-width: 200px; display:block; margin-bottom:8px;">
                {% endif %}
                <div class="upload-area" onclick="document.getElementById('id_director_image').click()">
                    <svg class="upload-icon"><use href="#icon-upload"></use></svg>
                    <span class="upload-text">Click to upload new image</span>
                    <input class="file-input" type="file" name="director_image" id="id_director_image" style="display:none;" accept="image/*">
                </div>
                 <div class="file-preview" id="director-file-preview" style="display: none; margin-top: 5px;">
                    <div class="file-info">
                        <svg width="16" height="16"><use href="#icon-upload"></use></svg>
                        <span id="director-file-name"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="id_org_chart_image" class="form-label">Organization Chart Image</label>
            <div style="flex:1;">
                {% if about.org_chart_image %}
                    <img src="{{ about.org_chart_image.url }}" alt="Current Org Chart Image" style="max-width: 200px; display:block; margin-bottom:8px;">
                {% endif %}
                 <div class="upload-area" onclick="document.getElementById('id_org_chart_image').click()">
                    <svg class="upload-icon"><use href="#icon-upload"></use></svg>
                    <span class="upload-text">Click to upload new chart</span>
                     <input class="file-input" type="file" name="org_chart_image" id="id_org_chart_image" style="display:none;" accept="image/*">
                </div>
                <div class="file-preview" id="org-chart-file-preview" style="display: none; margin-top: 5px;">
                    <div class="file-info">
                        <svg width="16" height="16"><use href="#icon-upload"></use></svg>
                        <span id="org-chart-file-name"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <a href="{% url 'about_us_dispatcher' %}" class="btn back" style="text-decoration: none;">Back</a>
            <button type="submit" class="btn edit">Save Changes</button>
        </div>
    </form>
</div>

<svg style="display:none;" xmlns="http://www.w3.org/2000/svg">
    <symbol id="icon-upload" viewBox="0 0 24 24" fill="currentColor">
        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
        <path d="M12,11L8,15H16L12,11Z" />
    </symbol>
</svg>

<script>
    function setupFilePreview(inputId, previewId, nameId) {
        const fileInput = document.getElementById(inputId);
        const filePreview = document.getElementById(previewId);
        const fileNameSpan = document.getElementById(nameId);

        if (!fileInput || !filePreview || !fileNameSpan) {
            console.error("Could not find elements for file preview:", inputId);
            return; // Exit if elements aren't found
        }

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];

            if (file) {
                fileNameSpan.textContent = file.name;
                // Directly set the display style to block (or flex if using flex)
                filePreview.style.display = 'block';
            } else {
                // Hide the preview if no file is selected or selection is cancelled
                filePreview.style.display = 'none';
                fileNameSpan.textContent = ''; // Clear the name
            }
        });
    }

    setupFilePreview('id_director_image', 'director-file-preview', 'director-file-name');
    setupFilePreview('id_org_chart_image', 'org-chart-file-preview', 'org-chart-file-name');

</script>
{% endblock %}